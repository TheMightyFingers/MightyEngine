'use strict';(function(a){var b=[],c=a||window;c.global=c;var d=function(){this.cbs=[]};d.prototype={release:function(){if(this.cbs.length)for(var a=0;a<this.cbs.length;a++)this.cbs.shift()()},push:function(a){this.cbs.push(a)}};var e=function(a,b){this.loadings=0;this.acc=new d;this.cache={};this.className=a;this.accumulator=b};e.prototype={onReady:function(a){0===this.loadings?window.setTimeout(a,0):this.acc.push(a)},_onload:function(){this.loadings--;this.onScriptsLoaded()},getScript:function(a,
b){var d=this;if(2===this.cache[a]||window.cache&&window.cache[a])"function"==typeof b&&b();else if(1===this.cache[a])c.setTimeout(function(){d.getScript(a,b)},100);else{this.cache[a]=1;this.loadings++;var e=c.script=document.createElement("script");e.setAttribute("data-origin",this.className);e.setAttribute("async","async");e.onload=function(){d.cache[a]++;"function"==typeof b&&b();d._onload(this)};e.onerror=function(){console.error("FATAL ERROR - onReady won't be called",e.src)};e.src=a;document.head.appendChild(e)}},
get:function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4===c.readyState&&b()};c.open("GET",a,!0);c.send(null)},onScriptsLoaded:function(){0==this.loadings&&(this.accumulator.release(),this.acc.release())}};c.createClass=function(c,g,i){var c=c||a,i=i||"src",j=new d,h=function(a,b,c){for(var a=a.split("."),d=a.pop(),e=k,f="",b=b||"",f=0;f<a.length;f++)e[a[f]]=e[a[f]]||{},e=e[a[f]];if(e[d])c&&c();else return f=0<a.length?a.join("/")+"/":"",b=b+k.basePath+"/"+f+d+".js",k.loader.getScript(b,
c),!1;return!0},m=function(a,b,c){for(var d in b.prototype)void 0===a[d]&&(a[d]=b.prototype[d]),void 0===a.prototype[d]&&(a.prototype[d]=b.prototype[d]);for(var e in c)a.prototype[e]=c[e],void 0===a[e]&&(a[e]=c[e])},k=function(a,c){var d=k;a.extend=function(b){if("function"==typeof b)return m(a,parentClass,c),a;var e=function(){var f;f=b.split(".");f.pop();for(var g=d,l=0;l<f.length;l++)g=g[f[l]];(f=g[b.split(".").pop()])?m(a,f,c):(console.error("failed to resolve",b),window.setTimeout(e,1E3))};h(b,
null,e);return a};for(var e in c)"function"===typeof c[e]&&(a[e]=c[e]);c&&(a.prototype=c);for(;b.length;)a.extend(b.shift());j.release();return a};k.basePath=i;k.emptyFn=function(){};k.scope=c;k.scopeName="";k.require=function(a,b,c){h(a,b,c);return this};k.requireFile=function(a,b){k.loader.getScript(a,b);return this};k.namespace=function(a){for(var a=a.split("."),b=k,c=0;c<a.length;c++)b[a[c]]=b[a[c]]||{},b=b[a[c]];k.scopeName=a[c-1];k.scope=b};k.removeDebug=function(){for(var a=document.getElementsByTagName("script"),
b=0;b<a.length;b++)a[b].getAttribute("data-origin")==g&&(a[b].parentNode.removeChild(a[b]),b--);delete c.Class};k.loader=new e(g,j);k.onReady=function(a){k.loader.onReady(a)};k.extend=function(a){b.push(a);return this};return c[g]=k}})("undefined"==typeof window?global:window);
window.cache={"js/tools/cookie.js":1,"js/Socket.js":1,"js/config.js":1,"js/tools/tools.js":1,"js/pluginsList.js":1,"js/tools/otito.js":1,"js/templates.js":1,"js/tools/iscroll.js":1,"js/tools/fileuploader.js":1,"js/plugins/_menu/_Menu.js":1,"js/plugins/_plugin/_Plugin.js":1,"js/plugins/addon/Addon.js":1,"js/plugins/branch/Branch.js":1,"js/plugins/branch/branch.tpl.js":1,"js/plugins/brush/Brush.js":1,"js/plugins/component/Component.js":1,"js/plugins/entity/Entity.js":1,"js/plugins/deploy/Deploy.js":1,
"js/plugins/i18n/i18n.js":1,"js/plugins/multiImport/MultiImport.js":1,"js/plugins/texture/Texture.js":1,"js/plugins/multiImport/templates.js":1,"js/plugins/plugin/Plugin.js":1,"js/plugins/map/Map.js":1,"js/plugins/map/Map.tpl.js":1,"js/plugins/project/Project.js":1,"js/plugins/sideMenu/SideMenu.js":1,"js/plugins/sound/Sound.js":1,"js/plugins/topMenus/TopMenus.js":1,"js/plugins/sourceEditor/SourceEditor.js":1,"js/plugins/fastUpload/FastUpload.js":1,"js/i18n.js":1,"js/UI.js":1,"js/tools/tools.ui.js":1};
var global=window.global=window;createClass(global||window,"Mighty","js");var Mighty=global.Mighty;global.Templates={};Mighty.require("tools.cookie").require("Socket").require("config").requireFile("js/tools/tools.js").requireFile("js/pluginsList.js").requireFile("js/tools/otito.js").requireFile("js/templates.js").requireFile("js/tools/iscroll.js").requireFile("js/tools/fileuploader.js").require("pluginsList").require("UI").requireFile("socket.io/socket.io.js",null,1);
Mighty(Mighty.Editor=function(){this.projectInfo=null;this.knownProjects={};this.knownGroups={};this.action="";this.fullPath=[];this.activeItem=null;this.activeGroup={};this.buffer={};this.plugins={};this.userPlugins={};this.MightyPlugins={};this.uploadPath="";this.selectedItems=[];this.mapPort=0;this.demoMode=!1;this.projects=null;this.onCalls=[];this.onActions={};this.ui=new Mighty.ui.UI(this);this.load=new Mighty.Load(this);this.init()},{init:function(){this.cfg=window.cfg;var a=Storage.get("projectInfo");
a&&(this.knownProjects=a);this.load.init(this);this.ui.init(this);this.starting()},starting:function(){var a=this;this.load.projects(function(b){a.projects=b;a.getActiveProject(b)})},setAction:function(a){this.action=a||cfg.defaultAction;this.fullPath=[];this.ui.$settings.empty();this.ui.$search.val("");this.ui.groupsInitialized=0;this.ui.setPath("Loading... Please wait..");if(this.action){if(this.onActions[this.action])for(a=0;a<this.onActions[this.action].length;a++)this.onActions[this.action][a](this.action);
for(a=0;a<this.onCalls.length;a++)this.onCalls[a](this.action);this.ui.setInfo();this.startAction()}},on:function(a,b){"string"===typeof a?(this.onActions[a]||(this.onActions[a]=[]),this.onActions[a].push(b)):this.onCalls.push(a)},getActiveProject:function(){var a=this,b=window.location.hash.substring(1);this.getProjectInfo(b);for(var b=this.projectInfo.project,c=!1,d=0;d<this.projects.length;d++)if(this.projects[d]===b){c=!0;break}!c&&this.demoMode?this.genNewProject(function(b){a.setActiveProject(b)}):
this.demoMode?a.setActiveProject(b):this.ui.showStartingScreen(this.projects,b)},getProjectInfo:function(a){var b=this.knownProjects[a];b?this.projectInfo=b:(this.projectInfo=Tools.clone(this.cfg.defaultProjectInfo),this.projectInfo.project=a)},genNewProject:function(a){var b={name:"snakedemo"+(this.projects.length+1)};this.load.newProject(b,function(c){c||a(b.name)})},newProject:function(a,b){var c={name:a},d=this;this.ui.startLoading(_("label_creating_new_project"));this.load.newProject(c,function(c){c&&
c.error?(console.error("Error",c),b&&b(c.error)):d.setActiveProject(a)})},setActiveProject:function(a){this.uploadPath=a+"/"+cfg.uploadPath;this.getProjectInfo(a);window.location.hash=a;this.activeProjectPath=this.activeProject=document.title=a;this.load.setProject(this.activeProject,function(){b.setActiveBranch(b.projectInfo.branchId)});var b=this;this.fullReset(function(){b.load.deploy();b.saveProjectInfo();window.setTimeout(function(){b.setAction(b.action)},10)})},saveProjectInfo:function(){this.knownProjects[this.projectInfo.project]=
this.projectInfo;Storage.set("projectInfo",this.knownProjects)},setActiveBranch:function(a){this.projectInfo.branchId!=a&&(this.buffer={},this.projectInfo.branchId=a,this.saveProjectInfo(),this.ui.setInfo(),this.load.allItems(),this.plugins.Map.loadMap())},getItemFromElement:function(a){return this.getItem($(a).data("id"))},setData:function(a,b){b=b||this.action;this.buffer[b]={};for(var c=0;c<a.length;c++){for(var d in a[c])isNumber(a[c][d])&&"object"!==typeof a[c][d]&&(a[c][d]=parseFloat(a[c][d]));
this.buffer[b][a[c].id]=a[c]}},onItemChanged:function(a){a.editor||console.error("BAD item",a);if(this.plugins.Branch&&this.plugins.Branch.isInTree(a.editor.branch)){var b=a.editor.type||this.action;this.buffer[a.editor.type]||(this.buffer[a.editor.type]={});this.buffer[a.editor.type][a.id]=a;if(b=this.plugins[b])this.activeItem&&this.activeItem.object.id==a.id?b.itemChanged(a):a.editor.type==this.action&&(this.activeGroup&&(this.activeGroup[a.editor.type]==a.editor.group||this.activeGroup[a.editor.type]==
a.editor.oldGroup))&&b.itemChanged(a),b.createList()}},onDeployDone:function(){},fullReset:function(a){this.ui.startLoading("Initializing...");this.onCalls=[];this.onActions={};this.buffer={};window.Import={};window.ImportDef={};window.rawImport=null;window.Lists={};this.activeGroup={};this.needReinit=!0;this.onUpdate=a},updateImport:function(){if(this.needReinit){this.needReinit=!1;for(var a in this.plugins)this.buffer[a]={},"function"===typeof this.plugins[a].deInit&&this.plugins[a].deInit(),delete this.plugins[a];
var b=this;this.load.scripts(function(){b.ui.stopLoading();b.initCorePlugins();b.load.allItems(function(){b.onUpdate&&(b.onUpdate(),b.onUpdate=null)})})}},itemDeleted:function(a){var b=this.plugins[this.action];delete this.buffer[a.editor.type][a.id];this.needRefreshView=0;this.activeItem&&this.activeItem.object.id==a.id?(this.activeItem.object=a,this.activeItem.refresh(),this.ui.removeSettings(),this.needRefreshView=1):a.editor.type==this.action&&(this.activeGroup&&this.activeGroup[a.editor.type]==
a.editor.group)&&(this.needRefreshView=1);b.itemDeleted(a,this.needRefreshView)},refreshPlugins:function(){for(var a in this.plugins)"function"===typeof this.plugins[a].refresh&&this.plugins[a].refresh()},showInfo:function(){},startAction:function(){var a=this;Templates.clearCallbacks();a.plugins[a.action]&&a.plugins[a.action].start(function(b,c){if(void 0===c||void 0===c.noView)"function"===typeof a.plugins[a.action].setView?a.plugins[a.action].setView(a.plugins[a.action].activeItem):a.ui.setView(a.plugins[a.action].activeItem)})},
newAsset:function(){this.plugins[this.action].newAsset()},sortData:function(a,b){b=b||this.action;a=a||"sort";this.sortedData=[];for(var c in this.buffer[b])this.sortedData.push(this.buffer[b][c]);this.sortedData.sort(function(b,c){var f,g;"sort"==a?(f=parseInt(b.editor[a]),g=parseInt(c.editor[a])):(f=b[a],g=c[a]);return f>g?1:f<g?-1:f==g?b.name>c.name?1:-1:f>g})},getItem:function(a){if("undefined"!=typeof this.buffer[this.action][a])return this.buffer[this.action][a]},initCorePlugins:function(){this.initPlugins(1)},
initPlugins:function(){var a="";this.plugins={};for(a in Mighty.plugins)"function"===typeof Mighty.plugins[a]&&(this.plugins[a]=new Mighty.plugins[a](this),this.plugins[a].name=a,this.plugins[a].content=this);for(a in this.plugins)this.registerPlugin.call(this.plugins[a],this);for(a in this.plugins)this.initPlugin.call(this.plugins[a],this);this.load.userPlugins()},initUserPlugins:function(){this.MightyPlugins[this.activeProject]||(this.MightyPlugins[this.activeProject]=Mighty.plugin,Mighty.plugin=
{});var a=this.MightyPlugins[this.activeProject];this.userPlugins[this.activeProject]={};var b=this.userPlugins[this.activeProject],c;for(c in a)b[c]=new a[c],b[c].name=c,b[c].content=this;for(c in b)this.registerPlugin.call(b[c],this);for(c in b)this.initPlugin.call(b[c],this),this.plugins[c]=b[c];this.plugins.SideMenu.buildMenu()},initPlugin:function(a){this.content=a;"function"===typeof this.init&&this.init(a)},registerPlugin:function(a){this.content=a;"function"===typeof this.register&&this.register(a)},
resolvePluginDeps:function(a){if(void 0===this.extends)return this;for(var b=this.extends.length-1;-1<b;b--)if($.browser.msie){var c=a.resolvePluginDeps.call(a.plugins[this.extends[b]],a),d;for(d in c)"undefined"===typeof this[d]&&(this[d]=c[d])}else this.__proto__=a.plugins[this.extends[b]];return this},getPluginItems:function(a){var b=Object.keys(this.plugins);this.getPluginItem(b,0,a)},getPluginItem:function(a,b,c){var d=a[b];if(a.length<=b)c();else{var e=this;"function"==typeof this.plugins[d].getItems?
this.plugins[d].getItems.call(this.plugins[d],function(){e.getPluginItem(a,++b,c)}):this.getPluginItem(a,++b,c)}},getEnginePlugin:function(a){var b=this.buffer.Plugin;if(b)for(var c in b){var d=b[c];if(d.name===a)return d}},saveItem:function(a,b){if(void 0===b)console.error("Cannot save item without plugin");else{var c=this.plugins[b],d=this.buffer[b][a.id],e;for(e in a)d[e]=a[e];c.saveItem(d)}}});Mighty.loader.onReady(function(){window.MightyEditor=new Mighty.Editor});var lang=lang||{};
global._=function(a){if(lang[a])return lang[a];lang[a]=a;console.error("unlocalized string ["+a+"]");return a};
var Cookie={set:function(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString()}else c="";document.cookie=a+"="+b+c+"; path=/"},get:function(a){for(var a=a+"=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null},del:function(a){this.set(a,"",-1)}},Storage={set:function(a,b){var c=JSON.stringify(b);"object"===typeof localStorage?localStorage.setItem(a,
c):cookie.set(a,c,180)},get:function(a){var a=localStorage.getItem(a)||Cookie.get(a),b=null;try{b=JSON.parse(a)}catch(c){}return b},del:function(a){"object"!=typeof localStorage?cookie.del(a):localStorage.removeItem(a)}};Mighty.requireFile("socket.io/socket.io.js",null,1);
Mighty(Mighty.Load=function(a){this.content=a;this.socket=null;this.needRefreshView=0},{init:function(a){this.content=a;this.initSocket()},initSocket:function(){var a=this,b=window.location;this.socket=io.connect(b.protocol+"//"+b.hostname+":"+b.port);this.socket.on("connection",function(){});this.socket.on("action",function(b){var d="a_"+b.action;if("function"===typeof a[d])a[d](b.data);else console.warn("unknown input from server:",b)});this.socket.on("disconnect",function(){a.content.ui.showError("Connection lost",
"",function(){a.socket.socket.reconnect()})})},action:function(a,b,c){this.socket.emit("action",{action:a,data:b},function(a){(!a||!a._error)&&"function"===typeof c&&c(a)})},setProject:function(a,b){this.action("setProject",a,b)},a_setProject:function(a,b){this.content.setActiveProject(a,null,b)},a_setDefaultProject:function(){this.content.getActiveProject()},a_updateGamePort:function(a){this.content.mapPort=a;this.content.plugins.Map&&this.content.plugins.Map.setPort(a)},a_setDemo:function(a){this.content.demoMode=
a},a_scripts:function(){},a_updateImport:function(a){window.Import=a.Import;window.ImportDef=Tools.fixImportDef(a.ImportDef);this.content.updateImport()},a_FIXME:function(a){console.error("FIX me",a)},allItems:function(a){var b=this;this.action("getAllItems",{branch:this.content.projectInfo.branchId},function(c){b.a_allItems(c,a)})},a_allItems:function(a,b){this.content.nameBuffer={};for(var c=0,d=a.length;c<d;c++){var e=a[c],f=e.editor.type;null==this.content.buffer[f]&&(this.content.buffer[f]={});
null==this.content.nameBuffer[f]&&(this.content.nameBuffer[f]={});this.content.buffer[f][e.id]=e;this.content.nameBuffer[f][e.name]=e}this.content.getPluginItems(function(){b&&b()})},userPlugins:function(){var a=this;this.action("getUserScripts",null,function(b){for(var c=0;c<b.length;c++){var d=b[c].substring(14);Mighty.requireFile(d)}Mighty.loader.onReady(function(){a.content.initUserPlugins()})})},a_itemsChanged:function(a){for(var b=this,c=this.needRefreshView=0,d=a.length;c<d;c++)this.content.onItemChanged(a[c]);
this.needRefreshView&&this.content.ui.refreshView();this.onDeployDone=function(){b.onDeployDoneTmp()};this.content.refreshPlugins()},a_itemDeleted:function(a){if(a&&this.content.plugins.Branch.isInTree(a.editor.branch)){var b=this.content.buffer[a.editor.type][a.id];(!b||!(b.editor.branch===this.content.projectInfo.branchId&&a.editor.branch!==this.content.projectInfo.branchId))&&this.content.itemDeleted(a)}},a_deployDone:function(){this.onDeployDone&&(this.onDeployDone(),this.onDeployDone=null);this.content.onDeployDone()},
a_error:function(a){this.content.ui.showError(a)},a_importError:function(a){this.content.ui.showError(a)},onDeployDone:null,onDeployDoneTmp:function(){if(this.content.plugins.Map&&!("Map"==this.content.action&&this.needRefreshView))if(void 0==this.content.activeItem)this.content.plugins.Map.loadMap();else{var a=this.content.activeItem.object;a?a.editor&&"Map"==a.editor.type?this.content.plugins.Map.changeMap(a):"Map"!==this.content.action&&this.content.plugins.Map.loadMap():this.content.plugins.Map.loadMap()}},
getImport:function(a,b){this.action("getImport",function(a){this.a_allItems(a);"function"===typeof b&&b()})},scripts:function(a){this.action("scripts",null,function(){"function"==typeof a&&a()})},base:function(a,b){a.branch=a.branch||this.content.projectInfo.branchId;var c=a.action;("null"==a.id||""==a.id||null==a.id)&&delete a.id;delete a.action;this.action(c,a,b)},getBranchTree:function(a){this.base({action:"getBranchesTree",branch:1},function(b){"function"==typeof a&&a(b)})},activeUserInfo:function(a){this.base({action:"get_user_info",
branch:"1",where:{type:"users"},order:["name","id"]},function(b){"function"===typeof a&&a(b)},0,1)},item:function(a,b,c){a&&this.base({action:"get",where:{id:a}},function(a){"function"===typeof b&&b(a)},c)},items:function(a,b){b(this.content.buffer[a])},newItem:function(a,b,c){this.base({action:"set",type:b,data:a},function(a){"function"===typeof c&&c(a)})},saveItem:function(a,b,c,d){var e=this,c=c||this.content.action,e=this,f=this.content.projectInfo.branchId,g={action:"set",id:a.id,branch:f,type:c,
data:a};a.editor&&a.editor.__new__branch&&(f=a.editor.__new__branch,delete a.editor.__new__branch,f!=a.editor.branch&&(a.editor.branch=this.content.projectInfo.branchId,this.delItem(a)),a.editor.branch=f,g.branch=f);if(!d)var i=e.content.ui.showNotify(_("Saving..."),_(c)+": "+a.name,999999);this.base(g,function(a){"function"===typeof b&&b(a);d||(i.title("Saved!"),i.hide(3E3))},d)},multiSaveItems:function(a,b,c){for(var c=c||this.content.action,d={action:"sets",data:[]},e=0;e<a.length;e++)d.data.push({action:"set",
id:a[e].id,branch:this.content.projectInfo.branchId,type:c,data:a[e],project:this.content.projectInfo.project});this.base(d,b)},delItem:function(a,b){a.editor.branch!=this.content.projectInfo.branchId?this.content.ui.showError("You cannot delete items from another branches - it may break another branch! If you want to delete this item go to item's branch ("+this.content.ui.getBranchName(a.editor.branch)+") and delete it from there"):this.base({action:"del",id:a.id},b)},saveOrder:function(){for(var a=
[],b=0;b<this.content.sortedData.length;b++)this.content.sortedData[b].editor.sort=b,a.push(this.content.sortedData[b].id);this.base({action:"sort",data:a},null,1)},deploy:function(a,b){b=b||{};b.branch=b.branch||this.content.projectInfo.branchId||1;var c=null;b.full&&(c=this.content.ui.showNotify(_("Deploy in progress"),_("Deploy: ")+b.name,999999));this.action("deploy",b,function(b){c&&(c.title(_("Deploy completed")),c.hide(2E3));a&&a(b)})},exportProject:function(){var a=this;this.action("export",
null,function(){window.location="/"+a.content.activeProjectPath+"/.editor/"+a.content.activeProject+"."+a.content.cfg.projectExtension})},createBranch:function(a,b){this.base({action:"setBranch",parent:b||"1",name:a||"Unnamed"})},updateBranch:function(a,b,c,d){c=c||a.name;b=b||a.parent;this.updateBranchById(a.id,b,c,d)},updateBranchById:function(a,b,c,d){a={action:"setBranch",id:a};b&&"undefined"!=typeof b&&(a.parent=b);c&&(a.name=c);this.base(a,function(a){"function"==typeof d&&d(a)})},projects:function(a){this.base({action:"get_projects",
branch:1},function(b){"function"===typeof a&&a(b)})},newProject:function(a,b){a.action="new_project";this.base(a,function(a){"function"===typeof b&&b(a)})},delProject:function(a,b){var c={};c.name=a;c.action="del_project";this.base(c,function(a){"function"===typeof b&&b(a)})},delBranch:function(a,b){this.base({action:"delBranch",branchId:a,id:a},function(a){"function"===typeof b&&b(a)})},delData:function(){var a=this;this.items("data",function(b){for(var c=0;c<b.length;c++)a.delItem(b[c].id);a.content.buffer=
{}})}});
this.cfg=global.cfg={sourceEditorBackend:"CodeMirror",zoomOnResize:!1,zoomOnLoad:!1,defaultAction:"Texture",synchroTimeout:120,uploadPath:".editor/upload/",projectExtension:"mighty",defaultImage:"null.png",uploadFile:"/upload",imageExtensions:["png","jpg","jpeg","png"],soundExtensions:["mp3","ogg","m4a","wav"],defaultGroup:"ungrouped",defaultInputs:{id:{_type:"hidden",value:null},name:{_type:"string",value:"",placeholder:"enter name"}},editorData:{color:{_type:"color",value:"#ffffff"},group:{_type:"text",value:"ungrouped"},
sort:{_type:"hidden",value:0},branch:{_type:"list",_use:"Lists.Branch",_reverse:1,_filter:function(a,b){return MightyEditor.plugins.Branch.isInTree(b)},onchange:function(a){a.object.__new__branch=this.value},value:1},type:{_type:"hidden",value:""},origin:{_type:"hidden",value:""}},defaultProjectInfo:{project:"",branchId:1,path:"",action:""},defaultBranchName:"New Branch",ui:{$search:"#search",$searchBlock:"#searchBox",$toSave:"#contentToSave",$mainMenu:"#mainMenu",$subMenu:"#subMenu",$iconContainer:"#iconContainer",
$deployMenu:"#deployMenu",$deploy:"#deploy",$playGame:"#playGame",$logout:"#logout",$logoutUsername:"#logoutUsername",$topBar:"#topBar",$mainView:"#mainRight",$settingsBlock:"#mainLeft",$settings:"#contentToSave",$mapFrame:"#mapFrame",$importFrame:"#import",$mapControls:"#mapControls",$mapTools:"#mapTools",$map:"#mapWrapper",$groups:"#groups",$info:"#info",$iconWrapper:"#iconWrapper",$helperButtons:"#helperButtons",$fileMenu:"#fileMenu",$groupAndSearch:"#groupAndSearch",$reloadImport:"#reloadImport",
$export:"#export",$changeView:"#changeView"}};this.Lists={};global=global||this.window||{};
this.Tools={createMeta:function(a,b,c,d,e){var d=d||global.Import,e=e||global.ImportDef,b=b||a.editor.plugin,f=null,g=null,i;d[b]&&(f=d[b].Type,g=this.reverse(f),i=a&&a.type?g[a.type]:g[0]);a=this.parseImportDef(b,i,e);if(!a)return null;if(f&&(a.type=a.type||{},a.type._type=a.type._type||"list",a.type._use=a.type._use||"Import."+b+".Type",c)){var j=a.type.onchange;a.type.onchange=function(){j&&j.call(this);c.call(this)}}return a},createPluginMeta:function(a,b,c){return this.parseImportDef("Cfg",a.name,
c)},createAddonMeta:function(a,b,c){c=c||global.ImportDef;return this.parseImportDef("Addon",a.name,c)},parseImportDef:function(a,b,c){c=c||global.ImportDef;b=b||a.toUpperCase();if(void 0==a||void 0==c[a])return null;a=this.clone(c[a]);a=a.ObjData||a;if(void 0==b||void 0==a[b])if(b=this.ucfirst(b),void 0==a[b])return a.BASIC;c=a[b];!c.extend&&"BASIC"!=b&&(c.extend="BASIC");b=this.collectExtend(c,a);b.extend&&delete b.extend;return b},collectExtend:function(a,b){if(!a.extend)return a;for(var c=[],
d=a;d&&d.extend&&"string"==typeof d.extend;)c.push(d.extend),d=b[d.extend];c.reverse();for(var d={},e=0,f=c.length;e<f;e++)d=this.mergeObject(b[c[e]],d);return d=this.mergeObject(a,d)},mergeObject:function(a,b){if(void 0==a)return this.clone(b);if(void 0==b)return this.clone(a);var c;c=Array.isArray(a)?[]:{};var d=this.clone(a),e;for(e in b)c[e]=b[e];for(e in d){var f=typeof d[e];c[e]="object"===f&&null!==f?this.mergeObject(d[e],c[e]):d[e]}return c},clone:function(a){if(null==a||"object"!=typeof a)return a;
var b=null;if(a instanceof Date)return b=new Date,b.setTime(a.getTime()),b;if(a instanceof Array){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=this.clone(a[c]);return b}if(a instanceof RegExp)return RegExp(a);b={};for(c in a)a.hasOwnProperty(c)&&(b[c]=this.clone(a[c]));return b},reverse:function(a){var b={},c;for(c in a)b[a[c]]=c;return b},isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},ucfirst:function(a){return"string"!==typeof a?(console.warn("Not string",a),a):a.charAt(0).toUpperCase()+
a.substring(1)},inArray:function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return c;return-1},strToFn:function(a){var b=a.substring(a.indexOf("{")+1,a.lastIndexOf("}")),a=a.substring(a.indexOf("(")+1,a.indexOf(")")),a=a.split(" ").join("");return new Function(a.split(","),b)},fixImportDef:function(a){var b=null;"object"==typeof a&&(b=Array.isArray(a)?[]:{});for(var c in a)"object"===typeof a[c]&&null!==a[c]?b[c]=this.fixImportDef(a[c]):a["__fn_src___"+c]||(b[c]=a["__fn__"+c]?this.strToFn(a[c]):
a[c]);return b}};Object.size=Object.size||function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};Mighty.require("plugins._menu._Menu").require("plugins._plugin._Plugin").require("plugins.addon.Addon").require("plugins.branch.Branch").require("plugins.brush.Brush").require("plugins.component.Component").require("plugins.deploy.Deploy").require("plugins.entity.Entity").require("plugins.i18n.i18n").require("plugins.multiImport.MultiImport").require("plugins.plugin.Plugin").require("plugins.project.Project").require("plugins.sideMenu.SideMenu").require("plugins.sound.Sound").require("plugins.texture.Texture").require("plugins.topMenus.TopMenus").require("plugins.sourceEditor.SourceEditor").require("plugins.fastUpload.FastUpload").requireFile("js/i18n.js");
var ImportType={bool:"bool","boolean":"boolean","int":"int",uint:"uint","float":"float",number:"number",text:"text",string:"string",textarea:"textarea",color:"color",list:"list",array:"array",add:"add",upload:"upload",hidden:"hidden",link:"link",folder:"folder"};
(function(a){var b=function(a,c,f,g,i){this.key=i;b.updateImport();b.updateImportDef();b.updateLists();this.parent=g||this;this.object=Tools.clone(a);void 0==c&&(c=a);this.origMeta=c;this.origObject=a;this.meta=this.setMeta(Tools.clone(c));this.childs=null;this.parseMeta();this.cleanUpMeta();this.cb=f};b.setImport=function(b){a.Import=b};b.setImportDef=function(b){a.ImportDef=b};b.setLists=function(b){a.Lists=b};b.updateImport=function(){};b.updateImportDef=function(){};b.updateLists=function(){};
b.getUse=function(b){if("string"!=typeof b)return b;for(var c=b.split("."),f=a,g=0;g<c.length;g++)f=f[c[g]];return void 0==f?(console.error("Failed to resolve ",b),{}):f};b.prototype={childs:null,parent:null,object:null,meta:null,cb:null,html:null,head:null,headless:!1,headName:null,body:null,input:null,_isChanged:!1,parentNode:null,empty:function(){},origObject:null,origMeta:null,setMeta:function(a){var c=typeof a;"function"==c&&(a={_make:a});if(void 0==a)return console.error("bad meta",this.parent.meta),
{};if(a._make){if("string"===typeof a._make)try{a._make=eval(a._make)}catch(f){console.error("META make eval failed",f)}if("string"===typeof a._make)console.error("META MAKE BAD!!!!!"),console.error(a,a._make);else{c=a._make;try{(a=c(this,this.parent))?a._make=c:(console.error("meta._make returned null",c),a={})}catch(g){console.error("Otito -> Make failed",g.message,g.stack),a={}}c=typeof a}}"object"!==c&&(a={_type:c,value:a});"string"==typeof a.use&&(a._use=a.use,a.use={});if(a._use)try{a.use=b.getUse(a._use)}catch(i){console.error("Import use failed to eval",
i,a._use)}if(a.use){var c={},j;for(j in a.use)c[a.use[j]]=j;a._reverse?(a.__reversed=a.use,a.use=c):a.__reversed=c}return a},metaToObject:function(a,c){if(c._valueOverride)return this.normalizeInput(c,c._valueOverride);if("object"==typeof c&&void 0!=c&&void 0===c._type)return new b(a,c,null,this.parent,"xxx");if(c._type==ImportType.list&&!c.__reversed[a]){this.parent.hasChanged("Otito changed cannot find LIST value: ");var f=Object.keys(c.__reversed);return this.normalizeInput(c,(c._reverse?c.__reversed[c._value]:
c.use[c._value])||c.value||f[0])}return this.normalizeInput(c,a)},normalizeInput:function(a,b){void 0===b&&this.parent.hasChanged("Otito changed ->  new value is undefined",this.key,a);var c;c=void 0==b?a.value:b;switch(a._type){case ImportType.bool:case ImportType.boolean:return"true"===c?!0:"false"===c?!1:!!c;case ImportType.int:case ImportType.uint:return parseInt(c,10)||0;case ImportType.float:case ImportType.number:return parseFloat(c)||0;case ImportType.text:case ImportType.string:case ImportType.textarea:return void 0!=
c?c+"":a.value||"";case ImportType.color:return c||"#FFFFFF";case ImportType.list:var g=parseInt(c);if(!(isNaN(c)||g+""!=c))return g}return c},parseMeta:function(){if(this.meta._type==ImportType.array){this.object=this.object||[];this.childs=[];this.meta.array=this.setMeta(this.meta.array);for(var a=0;a<this.object.length;a++)this.childs[a]=new b(this.object[a],this.meta.array,null,this.parent,a),this.object[a]=this.childs[a].object,this.meta[a]=this.childs[a].meta}else if(Array.isArray(this.meta)){this.childs=
[];this.object=this.object||[];for(a=0;a<this.meta.length;a++){var c=this.meta[a]._head;delete this.meta[a]._head;this.childs[a]=new b(this.object[a],this.meta[a],null,this.parent,a);void 0!=c&&(this.childs[a].meta._head=c);this.meta[a]=this.childs[a].meta;this.object[a]=this.childs[a].object}}else if("object"!==typeof this.meta)console.error("BAD META",this);else if(void 0!=this.meta._type)this.object=this.metaToObject(this.object,this.meta);else for(a in"object"!=typeof this.object&&(this.object=
{}),this.childs={},this.object=this.object||{},this.meta)"__"!=a.substring(0,2)&&"_make"!=a&&(this.childs[a]=new b(this.object[a],this.meta[a],null,this.parent,a),this.meta[a]=this.childs[a].meta,this.object[a]=this.childs[a].object)},cleanUpMeta:function(){if("object"===typeof this.object){for(var a in this.object)void 0===this.meta[a]&&delete this.object[a];for(a in this.childs)this.childs.hasOwnProperty(a)&&(this.object[a]=this.childs[a].object);this.object&&(!this.object.editor&&this.origObject&&
this.origObject.editor&&this.parent==this)&&(this.object.editor=this.origObject.editor)}},hasChanged:function(){this._isChanged=!0;this.origObject&&this.origObject.editor&&(this.parent.object.editor=this.origObject.editor)},getChanged:function(){return this._isChanged},createHTML:function(a){this.html=document.createElement("div");this.html.className=a||"main";if(Array.isArray(this.childs)){for(var b=Array.isArray(this.meta),c=0;c<this.childs.length;c++){var g=this.childs[c];if(void 0!=g.childs&&
!this.meta._type){a=g.meta._head||c;g.createHTML("content");var i=this.createFolder();i.appendChild(this.createHead(a));i.appendChild(g.html);this.html.appendChild(i)}else if(this.body||(this.body=document.createElement("div"),this.html.appendChild(this.body)),a="",this.meta&&(this.meta.array&&this.meta.array.addClass)&&(a=this.meta.array.addClass),g.childs)this.appendArrayElement(g);else{this.body||(this.body=document.createElement("div"),this.html.appendChild(this.body));a=this.createItemBody(c,
"item dynamicBlock "+a);g.input=a.input;g.html=a;if(!b){var j=this,g=this.createRemoveBtn();a.appendChild(g)}this.body.appendChild(a)}}b||(void 0==this.body&&(this.body=document.createElement("div"),this.html.appendChild(this.body)),this.html.className+=" inputDynamic",j=this,this.html.appendChild(this.createAddButton(function(){var a=j.metaToObject(null,j.meta.array);if("object"==typeof a)j.appendArrayElement(a),j.object.push(a.object);else{j.object.push(a);a=j.createItemBody(c,"item dynamicBlock "+
(j.meta.array.addClass||""));a.input=a.input;a.html=a;var b=j.createRemoveBtn();a.appendChild(b);j.body.appendChild(a);j.parent.beautify&&j.parent.beautify(j.object.length-1,{meta:j.meta.array,input:a.input,html:a})}})))}else{g=this.input;for(b in this.childs)if(a=this.childs[b],void 0!=a){var h=a.meta._head||b;a.childs?(this.addFolder("folder "+(this.meta.__className||"")),this.addHead(h),this.childs[b].createHTML("content "),this.body.appendChild(this.childs[b].html)):(i=" "+a.meta._type+" "+(a.meta._variant||
"")+" "+(a.meta.className||""),i=" "+i.trim(),a=a.meta._headless?null:this.createHead(h),a=this.createItemBody(b,"item"+i,a),this.childs[b].input=this.input,void 0!=a&&(this.html.appendChild(a),this.childs[b].html=a))}this.input=g}},appendArrayElement:function(a){a.append(this.body);a.html.className="item dynamicBlock";var b=this.createRemoveBtn();a.html.appendChild(b);b=document.createElement("div");b.className="clear";a.html.appendChild(b)},addHead:function(a){this.headless||this.body.appendChild(this.createHead(a))},
createHead:function(a){var b=document.createElement("div");b.className="head";b.innerHTML=this.headName||a;b.setAttribute("title",this.headName||a);return b},createFolder:function(a){void 0===a&&(a="folder");var b=document.createElement("div");b.className=a;b.appendChild(this.createArrow());return b},addOpenLink:function(){var a=document.createElement("a");a.innerHTML="OPEN";var b=this;a.onclick=function(){var a=$(b.body).clone();a.addClass("main");document.body.appendChild(a[0])};return a},addFolder:function(a){this.body=
this.createFolder(a);this.html.appendChild(this.body)},createArrow:function(){var a=document.createElement("div");a.className="arrow";return a},createItemBody:function(a,b,c){a=this.addInput(a);if(void 0!=a){var g=document.createElement("div");g.className=b||"item";c&&g.appendChild(c);g.input=this.input;g.appendChild(a);return g}},toInputType:function(a){switch(a){case ImportType.upload:return ImportType.text;case ImportType.color:return ImportType.color;case ImportType.int:case ImportType.float:case ImportType.uint:return ImportType.number}return a},
addInput:function(a){var b=null;this.meta._type==ImportType.link&&(this.headless=!0);this.meta._type==ImportType.array?(b=this.meta.array,this.headless=!0):b=this.meta[a];this.meta._type==ImportType.array&&Array.isArray(this.meta.array)&&(b=this.meta.array[a]);if(void 0!=b){void 0!=b._head&&(this.headName=b._head,this.headless=!1);switch(b._type){case ImportType.hidden:this.input=this.createInput(a,b);return;case ImportType.bool:case ImportType.boolean:b.__reversed={"true":!0,"false":!1},b._value=
!!b._value||!1;case ImportType.list:void 0==b.use&&void 0==b.__reversed&&console.error("no use for list",b._use);this.input=this.createList(b);this.input.value=this.object[a];break;case ImportType.array:this.input=this.createInput(a,b);var c=this.createWrapper();c.appendChild(this.createRemoveBtn());return c;case ImportType.textarea:this.input=document.createElement("textarea");this.input.value=this.object[a];break;case ImportType.int:b.step=b.step||1;this.input=this.createInput(a,b);break;case ImportType.uint:b.step=
b.step||1;b.min=b.min||0;this.input=this.createInput(a,b);break;case ImportType.link:this.input=this.createLink(a,b);break;default:this.input=this.createInput(a,b)}if(void 0==this.input)console.error("failed to create input",b);else{for(c in b)"_"==c.substring(0,1)?"_type"==c&&this.input.setAttribute("type",this.toInputType(b[c])):"value"!=c&&("object"==typeof b[c]||"function"==typeof b[c]?this.input[c]=b[c]:(this.input[c]=b[c],this.input.setAttribute(c,b[c])));var g=this;this.input.otito=this.parent;
if(b.oncreate)b.oncreate(this.input,this.parent);this.input.onchange=this.input.onkeyup=function(){void 0!=b.onchange&&b.onchange.call(this,g);g.normalizeInput(b,this.value)!=g.object[a]&&this.setValue(this.value)};this.input.cbs=[];this.input.setValue=function(c){this.value=c;g.object[a]=g.normalizeInput(b,this.value);for(var f in this.cbs)this.cbs[f](c);this.onchange()};return this.createWrapper()}}},createWrapper:function(){var a=document.createElement("div");a.className="input";void 0!=this.input&&
a.appendChild(this.input);return a},createList:function(a){var b=document.createElement("select"),c=null,g=[],i;for(i in a.__reversed)g.push(i);null!==a._sortFn&&g.sort(a._sortFn);for(var j=0;j<g.length;j++)if(i=g[j],!a._filter||a._filter(a.__reversed[i],i))c=document.createElement("option"),c.value=i,c.innerHTML=a.__reversed[i],b.appendChild(c);return b},createLink:function(a){var b=document.createElement("a");b.innerHTML=a;return b},createInput:function(a,b){var c=document.createElement("input");
c.value=this.object[a];c.type="text";c.meta=b;return c},createAddButton:function(a){var b=document.createElement("span");b.className="button";var c=document.createElement("a");c.innerHTML="Add more";c.onclick=a;b.appendChild(c);return b},createRemoveBtn:function(){var a=document.createElement("a");a.className="delete";var b=this;a.onclick=function(){var a=this.parentNode.parentNode,c=Array.prototype.indexOf.call(a.childNodes,this.parentNode);b.object.splice(c,1);a.removeChild(this.parentNode)};return a},
addClear:function(){var a=document.createElement("div");a.className="clear";this.body.appendChild(a)},append:function(a,b){void 0==this.html&&this.createHTML();this.parentNode=a||this.html.parentNode;void 0!=b?(a.replaceChild(this.html,b),this.html.className=b.className):a.appendChild(this.html);this.cb&&this.cb()},remove:function(){void 0!=this.parentNode&&this.html.parentNode&&this.parentNode.removeChild(this.html)},refresh:function(){var a=this.html;this.meta=this.setMeta(Tools.clone(this.origMeta));
this.parseMeta();this.createHTML();this.parent==this&&this.parentNode?this.append(this.parentNode,a):void 0!=a&&this.append(a.parentNode,a);"function"==typeof this.parent.beautify&&b.beautifyInputs(this,this.parent.beautify)}};var c=function(a,b){for(var f in a.childs){var g=a.childs[f];g.input&&g.html&&"function"===typeof b&&b(f,g);c(a.childs[f],b)}};b.beautifyInputs=function(a,b){a.beautify=b;c(a,b)};a.Otito=b})(this);
var Templates=this.Templates={_escape:function(a){return"undefined"===typeof a?"":a.replace('"','"')},fixDefaults:function(a,b){for(var c={},d=0;d<b.length;d++)c[b[d]]=a[b[d]]||"";return c},buttonId:0,button:function(a){a=this.fixDefaults(a,["id","title","text"]);""==a.id&&(a.id="id"+this.buttonId,this.buttonId++);return'\t\t\t<div class="button" title="'+a.title+'">\t\t\t\t<div class="gradient" id="'+a.id+'">'+a.text+"</div>\t\t\t</div>\t\t"},accordion:function(a){return'<div data-group="'+a.title+
'" class="'+a.type+'"></div>'},groups:function(){return'<div class="moveLeft"></div><div class="moveRight"></div><div id="groupList"><div id="groupContent"></div></div>'},groupIcon:function(a){return'<span class="groupIcon '+a.class+'" data-group="'+a.group+'">'+a.title+"</span>"},subMenuButton:function(a){return'<a href="#'+a.link+'" id="'+a.action+'" class="subMenu">'+a.title+"</a>"},saveBlock:function(a){var b="",c="",c='<div class="saveDeleteButtons">\t\t\t\t<div class="seperate"></div>\t\t\t\t<div class="right">\t\t';
"undefined"===typeof a._nosave&&(b="","function"===typeof a._save&&(b="data-cbid="+this.registerCB(a._save)+""),c+='<div class="delete button" >\t\t\t\t \t\t<div class="gradient" '+b+' data-action="save">'+_("btn_save")+"</div>\t\t\t\t </div>");"undefined"===typeof a._nosaveas&&(b="","function"===typeof a._saveAsNew&&(b="data-cbid="+this.registerCB(a._saveAsNew)+""),c+='<div class="saveAs button"><div class="gradient" '+b+' data-action="saveas">'+_("btn_copy")+"</div></div>");"undefined"===typeof a._nodelete&&
(b="","function"===typeof a._delete&&(b="data-cbid="+this.registerCB(a._delete)+""),c+='<div class="save button"><div class="gradient" '+b+' data-action="delete">'+_("btn_delete")+"</div></div>");"undefined"===typeof a._noadvance&&"function"===typeof a._advance&&(b="data-cbid="+this.registerCB(a._advance)+"",c+='<div class="saveAs button"><div class="gradient" '+b+' data-action="advance">'+_(a.advanceTitle)+"</div></div>");return c+'</div>\t\t\t\t<div class="seperate"></div>\t\t\t</div>\t\t'},row:function(a){return'\t\t\t<tr class="row containerElement" id="icon'+
a.id+'" title="'+a.name+'">\t\t\t\t<td class="id">'+a.id+'</td>\t\t\t\t<td class="text">'+a.name+'</td>\t\t\t\t<td class="text">'+a.name+"</td>\t\t\t</tr>"},deleteButton:function(){return'<a href="#delete" class="deleteButton">'+_("btn_delete")+"</a>"},clear:function(){return'<div class="clear"></div>'},audio:function(a){return'\t\t\t<audio>\t\t\t\t<source src="'+a.file+'" type="audio/'+a.ext+'" />\t\t\t\t<source src="'+a.file+'" type="audio/ogg" />\t\t\t\tYour browser does not support the audio tag.\t\t\t</audio>\t\t\t<div class="controls" data-element="audio">\t\t\t\t<div class="playstop" data-action="playstop"></div>\t\t\t</div>\t\t\t<div class="audio"></div>\t'},
image:function(a){return'<div class="imagePreview"><img src="'+a.file+'" /></div>'},unknown:function(){return'<div class="unknown">???</div>'},tools:function(a){return'<span class="'+a.class+' tooltip" tip="'+a.title+'"></span>'},toolsGroup:function(a){return'<span title="'+a.title+'"></span>'},activeItem:function(a){return"<span>"+a.title+"</span>"},playMap:function(a){return'<a id="playMap" href="engine/#'+a.mapID+'" target="_blank">'+_("btn_playMap")+"</a>"},info:function(a){a.project=a.project||
"&nbsp;";a.branch=a.branch||"&nbsp;";a.action=a.action||"&nbsp;";return'\t\t\t<span id="projectInfo" title="'+_("project")+'">'+a.project+' <strong>&gt;</strong></span>\t\t\t<span id="branchInfo" title="'+_("branch")+'">'+a.branch+' <strong>&gt;</strong></span>\t\t\t<span id="actionInfo" title="'+_("action")+'">'+a.action+"</span>\t\t\t\t"},layerTabs:function(a,b){for(var c='<div id="LayerTabs"><span class="layer-label">'+_("label_layers")+"</span>",d=0;d<a.length;d++){var e="";a[d]===b&&(e="active");
c+='<div class="tab '+e+'" data-layer="'+a[d]+'">'+a[d]+"</div>"}return c+"</div>"},deploy:function(a){var b="<ul>",c="",d="",e=0,f;for(f in a)a[f]&&(e++,b+='<li><a href="#tabs-'+e+'">'+f+"</a></li>",d=a[f].split("WARNING").join("<br />WARNING:<br />"),c+='<div id="tabs-'+e+'"><p><br />'+d+"</br /></p></div>");return'<div><div class="dialogContent">'+(b+"</ul>")+c+"</div></div>"},deployItem:function(){return'<li><a href="javascript:;">xxx</a></li>'},startingScreen:function(a,b){var c;c='<div class="startingScreen"><div id="logo"></div>'+
('<div class="mainLinks"><a href="javascript:;" data-action="newProject"><span class="largeButton"><span class="ui-icon ui-icon-document"></span>'+_("btn_create Project")+'</span></a><span class="largeButton ui-icon-transferthick-e-w"><span class="ui-icon ui-icon-transferthick-e-w"></span><div class="upload"></div>'+_("btn_import Project")+'</span><a href="http://docs.mightyfingers.com/"><span class="largeButton"><span class="ui-icon ui-icon-help"></span>'+_("btn_Documentation")+"</span></a></div>");
c+='<div class="projects"><span class="title">'+_("label_projects")+'</span><div class="allProjects">';for(var d=0;d<a.length;d++)c=a[d]==b?c+('<span class="projectItem active"><span class="ui-icon ui-icon-folder-open"></span>'+a[d]+"</span>"):c+('<span class="projectItem"><span class="ui-icon ui-icon-folder-collapsed"></span>'+a[d]+"</span>");c+="</div></div>";return c+"</div>"},newProject:function(){var a;a='<div class="newProjectPopup">'+('<div class="input"><span class="label">'+_("label_project_name")+
'</span><span class="group"><input type="text" value="" /></span></div>');return a+"</div>"},demoScreen:function(a,b){var c;c='<div class="startingScreen">'+('<div class="welcomeTitle">'+_("label_welcome_title")+"</div>");c+='<div class="mainLinks"><span><a href="http://docs.mightyfingers.com/">'+_("btn_Documentation")+'</a></span><span><a href="javascript:;">'+_("btn_Examples")+"</a></span></div>";c+='<div class="demoProject"><span class="title">'+_("label_your_test_project")+"</span>";c=c+('<span class="projectItem">'+
b+"</span>")+"</div>";return c+"</div>"},errorHolder:function(a,b){return'<div class="errorHolder"><span class="ui-icon ui-icon-alert"></span><span class="error-msg">'+a+'</span><span class="error-file">'+b+"</span></div>"},notify:function(a,b){return'<div class="notify"><span class="title">'+a+'</span><span class="itemTitle">'+b+"</span></div>"}};
Templates.iconView=function(a){var b=Templates.getTagByFile(a.image||a.img||a.sound||a.snd||a.file);return'<div class="icon containerElement '+(a.active?"active":"")+'" id="icon'+a.id+'" data-id="'+a.id+'" title="'+a.name+'">\t\t\t\t<div class="image" '+(a.color?'style="background-color: '+a.color+'"':"")+" >\t\t\t\t"+b+'\t\t\t\t\t<div class="branch">'+a.branch+'</div>\t\t\t\t</div>\t\t\t\t<div class="text">'+a.name+"</div>\t\t\t</div>\t"};Templates.emptyTable=function(){return'<table class="table"></table>'};
Templates.tableBuffer=null;Templates.tableHead=function(a,b){for(var c={id:"id",name:"name"},d="",e=0;e<a.length;e++)if(a[e].editor&&a[e].editor.group==b)for(d in a[e])"object"!=typeof a[e][d]&&(c[d]=d);e="<thead><tr >";for(d in c)"object"!=typeof c[d]&&(e+="<th>"+d+"</th>");Templates.tableBuffer=c;return e+"</tr></thead><tbody>"};
Templates.tableView=function(a){var b=a.object,c=Templates.tableBuffer;Templates.getTagByFile(a.img||a.file);var a='<tr id="icon'+b.id+'" data-id="'+b.id+'" title="'+b.name+'">',d="",e;for(e in c)"undefined"==typeof b[e]?a+='<td class="table_row_na">n/a</td>':"object"==typeof b[e]?a+='<td class="table_row_object">{...}</td>':(d=b[e]+"",0===d.indexOf("__enum__.Import.")&&(d=d.substring(16)),a+="<td>"+d+"</td>");return a+"</tr>"};
Templates.listView=function(a){return'<div class="iconList containerElement '+(a.active?"active":"")+'" id="icon'+a.id+'" data-id="'+a.id+'" title="'+a.name+'">\t\t\t\t<div class="text">'+a.name+'</div>\t\t\t\t<div class="description">'+a.object.en+" | "+a.object.lv+" | "+a.object.ru+"</div>\t\t\t</div>\t"};Templates.createSmallTemplate=function(){};
Templates.createTemplate=function(a,b,c){var d="",b=b||{},e;for(e in a){var f={},g;for(g in a[e])f[g]=a[e][g];var i="";a[e]&&a[e].style&&(i=a[e].style);0===e.indexOf("folder")?d=a[e].title?d+('<fieldset class="folder closed" style="'+i+'" id="folder_'+a[e].id+'">\t\t\t\t\t<div class="legend"><span class="ui-icon"></span>'+a[e].title+'</div>\t\t\t\t\t<div class="content">'+this.createTemplate(a[e],b,!0)+"</div>\t\t\t\t\t</fieldset>"):d+('<div style="'+i+'" id="folder_'+a[e].id+'">'+this.createTemplate(a[e],
b,!0)+"</div>"):"object"==typeof a[e]&&(b[e]&&(f._value=this.cleanup(b[e])),!f._value&&"object"!=typeof a[e].value&&(f._value=a[e].value),f._key=this.cleanup(e),f.cbId="function"===typeof f.cb?this.registerCB(f.cb):"",f.filterId="function"===typeof f.filter?this.registerFilter(f.filter):"",f._type||(f._type=Inputs.TEXT),f._type===Inputs.ADDMORE?(f.style=i,f.fid=a[e].id,d+=this.inputs[Inputs.ADDMORE](f)):"function"==typeof this.inputs[a[e]._type]&&(d+=this.inputs[a[e]._type](f)))}c||(d+=this.saveBlock(a));
return d};Templates.getTitle=function(a){return ucfirst(a)};Templates.createOptions=function(a){var b="",c;for(c in a)b+='<option value="'+c+'">'+a[c]+"</option>";return b};Templates.createOptionsR=function(a){var b="",c;for(c in a)b+='<option value="'+a[c]+'">'+c+"</option>";return b};Templates.createOptionsOO=function(a){var b="",c;for(c in a)b+='<option value="'+a[c]+'">'+a[c]+"</option>";return b};
Templates.createRadioInputs=function(a,b,c){var d="",e="",f;for(f in a)e=f==c?'checked="checked"':"",d+='<input type="radio" value="'+f+'" name="'+b+'" id="radio'+b+f+'" '+e+' /><label class="buttons" for="radio'+b+f+'">'+a[f]+"</label>";return d+'<div class="cb"></div>'};Templates.set=function(a,b){return this[b](a)};Templates.select=function(a){return"\t\t<select>\t\t"+Templates.createOptions(a)+"\t\t</select>\t"};
Templates.cleanup=function(a){var b=a;"string"===typeof a&&(b=a.replace(/'/g,"&apos;").replace(/"/g,"&quot;"));return b};Templates.callBacks=[];Templates.registerCB=function(a){this.callBacks.push(a);return this.callBacks.length-1};Templates.clearCallbacks=function(){this.callBacks.splice(0,this.callBacks.length)};Templates.filters=[];Templates.registerFilter=function(a){this.filters.push(a);return this.filters.length-1};Templates.saved=[];
Templates.registerSaved=function(a){this.saved.push(a);return this.saved.length-1};Templates.getTagByFile=function(a){if(!a)return Templates.set({ext:c,file:a},"unknown");var b=a.split("."),c=b.pop().toLowerCase();b.join(".");switch(c){case "png":case "jpg":case "jpeg":case "gif":case "bmp":return Templates.set({ext:c,file:a},"image");case "ogg":case "mp3":case "wav":return Templates.set({ext:c,file:a},"audio");default:return Templates.set({ext:c,file:a},"unknown")}};
Templates.createSimpleDD=function(a,b){var c={_key:a.title,_value:a.value,options:a.options,cbId:this.registerCB(b)};return this.inputs[Inputs.DROPDOWN](c)};Templates.collectGarbage=function(){Templates.callBacks=[];Templates.filters=[];Templates.saved=[]};
(function(){var a=Math,b=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":/trident/i.test(navigator.userAgent)?"ms":"opera"in window?"O":"",c=/android/gi.test(navigator.appVersion),d=/iphone|ipad/gi.test(navigator.appVersion),e=/playbook/gi.test(navigator.appVersion),f=/hp-tablet/gi.test(navigator.appVersion),g="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,i="ontouchstart"in window&&!f,j=b+"Transform"in document.documentElement.style,h=d||e,m=window.requestAnimationFrame||
window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1)},k=window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout,n="onorientationchange"in window?"orientationchange":"resize",t=i?"touchstart":"mousedown",
q=i?"touchmove":"mousemove",p=i?"touchend":"mouseup",u=i?"touchcancel":"mouseup",v="Moz"==b?"DOMMouseScroll":"mousewheel",r="translate"+(g?"3d(":"("),s=g?",0)":")",e=function(a,e){var f=this,x=document,w;f.wrapper="object"==typeof a?a:x.getElementById(a);f.wrapper.style.overflow="hidden";f.scroller=f.wrapper.children[0];f.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,hScrollbar:!0,vScrollbar:!0,
fixedScrollbar:c,hideScrollbar:d,fadeScrollbar:d&&g,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(){},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(w in e)f.options[w]=e[w];f.x=f.options.x;f.y=f.options.y;f.options.useTransform=j?f.options.useTransform:!1;f.options.hScrollbar=
f.options.hScroll&&f.options.hScrollbar;f.options.vScrollbar=f.options.vScroll&&f.options.vScrollbar;f.options.zoom=f.options.useTransform&&f.options.zoom;f.options.useTransition=h&&f.options.useTransition;f.options.zoom&&c&&(r="translate(",s=")");f.scroller.style[b+"TransitionProperty"]=f.options.useTransform?"-"+b.toLowerCase()+"-transform":"top left";f.scroller.style[b+"TransitionDuration"]="0";f.scroller.style[b+"TransformOrigin"]="0 0";f.options.useTransition&&(f.scroller.style[b+"TransitionTimingFunction"]=
"cubic-bezier(0.33,0.66,0.66,1)");f.options.useTransform?f.scroller.style[b+"Transform"]=r+f.x+"px,"+f.y+"px"+s:f.scroller.style.cssText+=";position:absolute;top:"+f.y+"px;left:"+f.x+"px";f.options.useTransition&&(f.options.fixedScrollbar=!0);f.refresh();f._bind(n,window);f._bind(t);f._bind("click");i||(f._bind("mouseout",f.wrapper),"none"!=f.options.wheelAction&&f._bind(v));f.options.checkDOMChanges&&(f.checkDOMTime=setInterval(function(){f._checkDOMChanges()},500))};e.prototype={enabled:!0,x:0,
y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,stopClick:0,handleEvent:function(a){switch(a.type){case t:if(!i&&0!==a.button)break;this._start(a);break;case q:this._move(a);this.moved&&(this.stopClick=1);break;case p:case u:this._end(a);break;case n:this._resize();break;case v:this._wheel(a);break;case "mouseout":this._mouseout(a);break;case "webkitTransitionEnd":this._transitionEnd(a);break;case "click":if(this.stopClick)return a.preventDefault(),a.cancelBubble=
!0,this.stopClick=0,!1}},_checkDOMChanges:function(){!this.moved&&(!this.zoomed&&!(this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale))&&this.refresh()},_scrollbar:function(c){var d=document,e;this[c+"Scrollbar"]?(this[c+"ScrollbarWrapper"]||(e=d.createElement("div"),this.options.scrollbarClass?e.className=this.options.scrollbarClass+c.toUpperCase():e.style.cssText="position:absolute;z-index:100;"+("h"==c?"height:7px;bottom:1px;left:2px;right:"+
(this.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(this.hScrollbar?"7":"2")+"px;top:2px;right:1px"),e.style.cssText+=";pointer-events:none;-"+b+"-transition-property:opacity;-"+b+"-transition-duration:"+(this.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(this.options.hideScrollbar?"0":"1"),this.wrapper.appendChild(e),this[c+"ScrollbarWrapper"]=e,e=d.createElement("div"),this.options.scrollbarClass||(e.style.cssText="position:absolute;z-index:100;",e.className="iScroll-bar"),e.style.cssText+=
";pointer-events:none;-"+b+"-transition-property:-"+b+"-transform;-"+b+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);-"+b+"-transition-duration:0;-"+b+"-transform:"+r+"0,0"+s,this.options.useTransition&&(e.style.cssText+=";-"+b+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),this[c+"ScrollbarWrapper"].appendChild(e),this[c+"ScrollbarIndicator"]=e),"h"==c?(this.hScrollbarSize=this.hScrollbarWrapper.clientWidth,this.hScrollbarIndicatorSize=a.max(this.hScrollbarSize*this.hScrollbarSize/
this.scrollerW>>0,8),this.hScrollbarIndicator.style.width=this.hScrollbarIndicatorSize+"px",this.hScrollbarMaxScroll=this.hScrollbarSize-this.hScrollbarIndicatorSize,this.hScrollbarProp=this.hScrollbarMaxScroll/this.maxScrollX):(this.vScrollbarSize=this.vScrollbarWrapper.clientHeight,this.vScrollbarIndicatorSize=a.max(this.vScrollbarSize*this.vScrollbarSize/this.scrollerH>>0,8),this.vScrollbarIndicator.style.height=this.vScrollbarIndicatorSize+"px",this.vScrollbarMaxScroll=this.vScrollbarSize-this.vScrollbarIndicatorSize,
this.vScrollbarProp=this.vScrollbarMaxScroll/this.maxScrollY),this._scrollbarPos(c,!0)):this[c+"ScrollbarWrapper"]&&(j&&(this[c+"ScrollbarIndicator"].style[b+"Transform"]=""),this[c+"ScrollbarWrapper"].parentNode.removeChild(this[c+"ScrollbarWrapper"]),this[c+"ScrollbarWrapper"]=null,this[c+"ScrollbarIndicator"]=null)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},c?200:0)},_pos:function(a,c){a=this.hScroll?a:0;c=this.vScroll?c:0;this.options.useTransform?this.scroller.style[b+
"Transform"]=r+a+"px,"+c+"px"+s+" scale("+this.scale+")":(a>>=0,c>>=0,this.scroller.style.left=a+"px",this.scroller.style.top=c+"px");this.x=a;this.y=c;this._scrollbarPos("h");this._scrollbarPos("v")},_scrollbarPos:function(a,c){var d="h"==a?this.x:this.y;this[a+"Scrollbar"]&&(d*=this[a+"ScrollbarProp"],0>d?(this.options.fixedScrollbar||(d=this[a+"ScrollbarIndicatorSize"]+(3*d>>0),8>d&&(d=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=d+"px"),d=0):d>this[a+"ScrollbarMaxScroll"]&&(this.options.fixedScrollbar?
d=this[a+"ScrollbarMaxScroll"]:(d=this[a+"ScrollbarIndicatorSize"]-(3*(d-this[a+"ScrollbarMaxScroll"])>>0),8>d&&(d=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=d+"px",d=this[a+"ScrollbarMaxScroll"]+(this[a+"ScrollbarIndicatorSize"]-d))),this[a+"ScrollbarWrapper"].style[b+"TransitionDelay"]="0",this[a+"ScrollbarWrapper"].style.opacity=c&&this.options.hideScrollbar?"0":"1",this[a+"ScrollbarIndicator"].style[b+"Transform"]=r+("h"==a?d+"px,0":"0,"+d+"px")+s)},mDown:0,_start:function(c){var d=
i?c.touches[0]:c,e,f;if(this.enabled){if(c.target)if("INPUT"!==c.target.nodeName&&"SELECT"!==c.target.nodeName&&"TEXTAREA"!==c.target.nodeName)this.options.onBeforeScrollStart&&this.options.onBeforeScrollStart.call(this,c);else return;else this.options.onBeforeScrollStart&&this.options.onBeforeScrollStart.call(this,c);(this.options.useTransition||this.options.zoom)&&this._transitionTime(0);this.zoomed=this.animating=this.moved=!1;this.dirY=this.dirX=this.absDistY=this.absDistX=this.distY=this.distX=
0;this.options.zoom&&(i&&1<c.touches.length)&&(f=a.abs(c.touches[0].pageX-c.touches[1].pageX),e=a.abs(c.touches[0].pageY-c.touches[1].pageY),this.touchesDistStart=a.sqrt(f*f+e*e),this.originX=a.abs(c.touches[0].pageX+c.touches[1].pageX-2*this.wrapperOffsetLeft)/2-this.x,this.originY=a.abs(c.touches[0].pageY+c.touches[1].pageY-2*this.wrapperOffsetTop)/2-this.y,this.options.onZoomStart&&this.options.onZoomStart.call(this,c));if(this.options.momentum&&(this.options.useTransform?(e=getComputedStyle(this.scroller,
null)[b+"Transform"].replace(/[^0-9-.,]/g,"").split(","),f=1*e[4],e=1*e[5]):(f=1*getComputedStyle(this.scroller,null).left.replace(/[^0-9-]/g,""),e=1*getComputedStyle(this.scroller,null).top.replace(/[^0-9-]/g,"")),f!=this.x||e!=this.y))this.options.useTransition?this._unbind("webkitTransitionEnd"):k(this.aniTime),this.steps=[],this._pos(f,e);this.absStartX=this.x;this.absStartY=this.y;this.startX=this.x;this.startY=this.y;this.pointX=d.pageX;this.pointY=d.pageY;this.startTime=c.timeStamp||Date.now();
this.options.onScrollStart&&this.options.onScrollStart.call(this,c);this._bind(q);this._bind(p);this._bind(u)}},_move:function(c){if(!("INPUT"===c.target.nodeName||"SELECT"===c.target.nodeName||"TEXTAREA"===c.target.nodeName)){var d=i?c.touches[0]:c,e=d.pageX-this.pointX,f=d.pageY-this.pointY,g=this.x+e,h=this.y+f,j=c.timeStamp||Date.now();this.options.onBeforeScrollMove&&this.options.onBeforeScrollMove.call(this,c);if(this.options.zoom&&i&&1<c.touches.length)g=a.abs(c.touches[0].pageX-c.touches[1].pageX),
h=a.abs(c.touches[0].pageY-c.touches[1].pageY),this.touchesDist=a.sqrt(g*g+h*h),this.zoomed=!0,d=1/this.touchesDistStart*this.touchesDist*this.scale,d<this.options.zoomMin?d=0.5*this.options.zoomMin*Math.pow(2,d/this.options.zoomMin):d>this.options.zoomMax&&(d=2*this.options.zoomMax*Math.pow(0.5,this.options.zoomMax/d)),this.lastScale=d/this.scale,g=this.originX-this.originX*this.lastScale+this.x,h=this.originY-this.originY*this.lastScale+this.y,this.scroller.style[b+"Transform"]=r+g+"px,"+h+"px"+
s+" scale("+d+")",this.options.onZoom&&this.options.onZoom.call(this,c);else{this.pointX=d.pageX;this.pointY=d.pageY;if(0<g||g<this.maxScrollX)g=this.options.bounce?this.x+e/2:0<=g||0<=this.maxScrollX?0:this.maxScrollX;if(h>this.minScrollY||h<this.maxScrollY)h=this.options.bounce?this.y+f/2:h>=this.minScrollY||0<=this.maxScrollY?this.minScrollY:this.maxScrollY;this.distX+=e;this.distY+=f;this.absDistX=a.abs(this.distX);this.absDistY=a.abs(this.distY);6>this.absDistX&&6>this.absDistY||(this.options.lockDirection&&
(this.absDistX>this.absDistY+5?(h=this.y,f=0):this.absDistY>this.absDistX+5&&(g=this.x,e=0)),this.moved=!0,this._pos(g,h),this.dirX=0<e?-1:0>e?1:0,this.dirY=0<f?-1:0>f?1:0,300<j-this.startTime&&(this.startTime=j,this.startX=this.x,this.startY=this.y),this.options.onScrollMove&&this.options.onScrollMove.call(this,c))}}},_end:function(c){if(!(i&&0!=c.touches.length)){var d=this,e=i?c.changedTouches[0]:c,f,g={dist:0,time:0},h={dist:0,time:0},j=(c.timeStamp||Date.now())-d.startTime,k=d.x,m=d.y;d._unbind(q);
d._unbind(p);d._unbind(u);d.options.onBeforeScrollEnd&&d.options.onBeforeScrollEnd.call(d,c);if(d.zoomed)k=d.scale*d.lastScale,k=Math.max(d.options.zoomMin,k),k=Math.min(d.options.zoomMax,k),d.lastScale=k/d.scale,d.scale=k,d.x=d.originX-d.originX*d.lastScale+d.x,d.y=d.originY-d.originY*d.lastScale+d.y,d.scroller.style[b+"TransitionDuration"]="200ms",d.scroller.style[b+"Transform"]=r+d.x+"px,"+d.y+"px"+s+" scale("+d.scale+")",d.zoomed=!1,d.refresh(),d.options.onZoomEnd&&d.options.onZoomEnd.call(d,
c);else{if(d.moved){if(300>j&&d.options.momentum){g=k?d._momentum(k-d.startX,j,-d.x,d.scrollerW-d.wrapperW+d.x,d.options.bounce?d.wrapperW:0):g;h=m?d._momentum(m-d.startY,j,-d.y,0>d.maxScrollY?d.scrollerH-d.wrapperH+d.y-d.minScrollY:0,d.options.bounce?d.wrapperH:0):h;k=d.x+g.dist;m=d.y+h.dist;if(0<d.x&&0<k||d.x<d.maxScrollX&&k<d.maxScrollX)g={dist:0,time:0};if(d.y>d.minScrollY&&m>d.minScrollY||d.y<d.maxScrollY&&m<d.maxScrollY)h={dist:0,time:0}}g.dist||h.dist?(g=a.max(a.max(g.time,h.time),10),d.options.snap&&
(h=k-d.absStartX,j=m-d.absStartY,a.abs(h)<d.options.snapThreshold&&a.abs(j)<d.options.snapThreshold?d.scrollTo(d.absStartX,d.absStartY,200):(h=d._snap(k,m),k=h.x,m=h.y,g=a.max(h.time,g))),d.scrollTo(k>>0,m>>0,g)):d.options.snap?(h=k-d.absStartX,j=m-d.absStartY,a.abs(h)<d.options.snapThreshold&&a.abs(j)<d.options.snapThreshold?d.scrollTo(d.absStartX,d.absStartY,200):(h=d._snap(d.x,d.y),(h.x!=d.x||h.y!=d.y)&&d.scrollTo(h.x,h.y,h.time))):d._resetPos(200)}else i&&(d.doubleTapTimer&&d.options.zoom?(clearTimeout(d.doubleTapTimer),
d.doubleTapTimer=null,d.options.onZoomStart&&d.options.onZoomStart.call(d,c),d.zoom(d.pointX,d.pointY,1==d.scale?d.options.doubleTapZoom:1),d.options.onZoomEnd&&setTimeout(function(){d.options.onZoomEnd.call(d,c)},200)):d.doubleTapTimer=setTimeout(function(){d.doubleTapTimer=null;for(f=e.target;1!=f.nodeType;)f=f.parentNode},d.options.zoom?250:0)),d._resetPos(200);d.options.onTouchEnd&&d.options.onTouchEnd.call(d,c)}}},_resetPos:function(a){var c=0<=this.x?0:this.x<this.maxScrollX?this.maxScrollX:
this.x,d=this.y>=this.minScrollY||0<this.maxScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y;c==this.x&&d==this.y?(this.moved&&(this.moved=!1,this.options.onScrollEnd&&this.options.onScrollEnd.call(this)),this.hScrollbar&&this.options.hideScrollbar&&("webkit"==b&&(this.hScrollbarWrapper.style[b+"TransitionDelay"]="300ms"),this.hScrollbarWrapper.style.opacity="0"),this.vScrollbar&&this.options.hideScrollbar&&("webkit"==b&&(this.vScrollbarWrapper.style[b+"TransitionDelay"]="300ms"),
this.vScrollbarWrapper.style.opacity="0")):this.scrollTo(c,d,a||0)},_wheel:function(a){var b=this,c,d;if(!("INPUT"===a.target.nodeName||"SELECT"===a.target.nodeName||"TEXTAREA"===a.target.nodeName)){if("wheelDeltaX"in a)c=a.wheelDeltaX/4,d=a.wheelDeltaY/4;else if("wheelDelta"in a)c=d=a.wheelDelta/4;else if("detail"in a)c=d=3*-a.detail;else return;"zoom"==b.options.wheelAction?(d=b.scale*Math.pow(2,1/3*(d?d/Math.abs(d):0)),d<b.options.zoomMin&&(d=b.options.zoomMin),d>b.options.zoomMax&&(d=b.options.zoomMax),
d!=b.scale&&(!b.wheelZoomCount&&b.options.onZoomStart&&b.options.onZoomStart.call(b,a),b.wheelZoomCount++,b.zoom(a.pageX,a.pageY,d,400),setTimeout(function(){b.wheelZoomCount--;!b.wheelZoomCount&&b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a)},400))):(c=b.x+c,d=b.y+d,0<c?c=0:c<b.maxScrollX&&(c=b.maxScrollX),d>b.minScrollY?d=b.minScrollY:d<b.maxScrollY&&(d=b.maxScrollY),b.scrollTo(c,d,0))}},_mouseout:function(a){var b=a.relatedTarget;if(b)for(;b=b.parentNode;)if(b==this.wrapper)return;this._end(a)},
_transitionEnd:function(a){a.target==this.scroller&&(this._unbind("webkitTransitionEnd"),this._startAni())},_startAni:function(){var b=this,c=b.x,d=b.y,e=Date.now(),f,g,h;b.animating||(b.steps.length?(f=b.steps.shift(),f.x==c&&f.y==d&&(f.time=0),b.animating=!0,b.moved=!0,b.options.useTransition?(b._transitionTime(f.time),b._pos(f.x,f.y),b.animating=!1,f.time?b._bind("webkitTransitionEnd"):b._resetPos(0)):(h=function(){var i=Date.now(),j;i>=e+f.time?(b._pos(f.x,f.y),b.animating=!1,b.options.onAnimationEnd&&
b.options.onAnimationEnd.call(b),b._startAni()):(i=(i-e)/f.time-1,g=a.sqrt(1-i*i),i=(f.x-c)*g+c,j=(f.y-d)*g+d,b._pos(i,j),b.animating&&(b.aniTime=m(h)))},h())):b._resetPos(400))},_transitionTime:function(a){a+="ms";this.scroller.style[b+"TransitionDuration"]=a;this.hScrollbar&&(this.hScrollbarIndicator.style[b+"TransitionDuration"]=a);this.vScrollbar&&(this.vScrollbarIndicator.style[b+"TransitionDuration"]=a)},_momentum:function(b,c,d,e,f){var c=a.abs(b)/c,g=c*c/0.0012;0<b&&g>d?(d+=f/(6/(6E-4*(g/
c))),c=c*d/g,g=d):0>b&&g>e&&(e+=f/(6/(6E-4*(g/c))),c=c*e/g,g=e);return{dist:g*(0>b?-1:1),time:c/6E-4>>0}},_offset:function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;a!=this.wrapper&&(b*=this.scale,c*=this.scale);return{left:b,top:c}},_snap:function(b,c){var d,e,f;f=this.pagesX.length-1;d=0;for(e=this.pagesX.length;d<e;d++)if(b>=this.pagesX[d]){f=d;break}f==this.currPageX&&(0<f&&0>this.dirX)&&f--;b=this.pagesX[f];e=(e=a.abs(b-this.pagesX[this.currPageX]))?
500*(a.abs(this.x-b)/e):0;this.currPageX=f;f=this.pagesY.length-1;for(d=0;d<f;d++)if(c>=this.pagesY[d]){f=d;break}f==this.currPageY&&(0<f&&0>this.dirY)&&f--;c=this.pagesY[f];d=(d=a.abs(c-this.pagesY[this.currPageY]))?500*(a.abs(this.y-c)/d):0;this.currPageY=f;f=a.max(e,d)>>0;return{x:b,y:c,time:f||200}},_bind:function(a,b,c){(b||this.scroller).addEventListener(a,this,!!c)},_unbind:function(a,b,c){(b||this.scroller).removeEventListener(a,this,!!c)},destroy:function(){this.scroller.style[b+"Transform"]=
"";this.vScrollbar=this.hScrollbar=!1;this._scrollbar("h");this._scrollbar("v");this._unbind(n,window);this._unbind(t);this._unbind(q);this._unbind(p);this._unbind(u);this.options.hasTouch||(this._unbind("mouseout",this.wrapper),this._unbind(v));this.options.useTransition&&this._unbind("webkitTransitionEnd");this.options.checkDOMChanges&&clearInterval(this.checkDOMTime);this.options.onDestroy&&this.options.onDestroy.call(this)},refresh:function(){var a,c,d,e=0;c=0;this.scale<this.options.zoomMin&&
(this.scale=this.options.zoomMin);this.wrapperW=this.wrapper.clientWidth||1;this.wrapperH=this.wrapper.clientHeight||1;this.minScrollY=-this.options.topOffset||0;this.scrollerW=this.scroller.offsetWidth*this.scale>>0;this.scrollerH=(this.scroller.offsetHeight+this.minScrollY)*this.scale>>0;this.maxScrollX=this.wrapperW-this.scrollerW;this.maxScrollY=this.wrapperH-this.scrollerH+this.minScrollY;this.dirY=this.dirX=0;this.options.onRefresh&&this.options.onRefresh.call(this);this.hScroll=this.options.hScroll&&
0>this.maxScrollX;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH);this.hScrollbar=this.hScroll&&this.options.hScrollbar;this.vScrollbar=this.vScroll&&this.options.vScrollbar&&this.scrollerH>this.wrapperH;a=this._offset(this.wrapper);this.wrapperOffsetLeft=-a.left;this.wrapperOffsetTop=-a.top;if("string"==typeof this.options.snap){this.pagesX=[];this.pagesY=[];d=this.scroller.querySelectorAll(this.options.snap);a=0;for(c=d.length;a<c;a++)e=
this._offset(d[a]),e.left+=this.wrapperOffsetLeft,e.top+=this.wrapperOffsetTop,this.pagesX[a]=e.left<this.maxScrollX?this.maxScrollX:e.left*this.scale,this.pagesY[a]=e.top<this.maxScrollY?this.maxScrollY:e.top*this.scale}else if(this.options.snap){for(this.pagesX=[];e>=this.maxScrollX;)this.pagesX[c]=e,e-=this.wrapperW,c++;this.maxScrollX%this.wrapperW&&(this.pagesX[this.pagesX.length]=this.maxScrollX-this.pagesX[this.pagesX.length-1]+this.pagesX[this.pagesX.length-1]);c=e=0;for(this.pagesY=[];e>=
this.maxScrollY;)this.pagesY[c]=e,e-=this.wrapperH,c++;this.maxScrollY%this.wrapperH&&(this.pagesY[this.pagesY.length]=this.maxScrollY-this.pagesY[this.pagesY.length-1]+this.pagesY[this.pagesY.length-1])}this._scrollbar("h");this._scrollbar("v");this.zoomed||(this.scroller.style[b+"TransitionDuration"]="0",this._resetPos(200))},scrollTo:function(a,b,c,d){var e=a;this.stop();e.length||(e=[{x:a,y:b,time:c,relative:d}]);a=0;for(b=e.length;a<b;a++)e[a].relative&&(e[a].x=this.x-e[a].x,e[a].y=this.y-e[a].y),
this.steps.push({x:e[a].x,y:e[a].y,time:e[a].time||0});this._startAni()},scrollToElement:function(b,c){var d;if(b=b.nodeType?b:this.scroller.querySelector(b))d=this._offset(b),d.left+=this.wrapperOffsetLeft,d.top+=this.wrapperOffsetTop,d.left=0<d.left?0:d.left<this.maxScrollX?this.maxScrollX:d.left,d.top=d.top>this.minScrollY?this.minScrollY:d.top<this.maxScrollY?this.maxScrollY:d.top,c=void 0===c?a.max(2*a.abs(d.left),2*a.abs(d.top)):c,this.scrollTo(d.left,d.top,c)},scrollToPage:function(a,b,c){c=
void 0===c?400:c;this.options.onScrollStart&&this.options.onScrollStart.call(this);this.options.snap?(a="next"==a?this.currPageX+1:"prev"==a?this.currPageX-1:a,b="next"==b?this.currPageY+1:"prev"==b?this.currPageY-1:b,a=0>a?0:a>this.pagesX.length-1?this.pagesX.length-1:a,b=0>b?0:b>this.pagesY.length-1?this.pagesY.length-1:b,this.currPageX=a,this.currPageY=b,a=this.pagesX[a],b=this.pagesY[b]):(a*=-this.wrapperW,b*=-this.wrapperH,a<this.maxScrollX&&(a=this.maxScrollX),b<this.maxScrollY&&(b=this.maxScrollY));
this.scrollTo(a,b,c)},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(q);this._unbind(p);this._unbind(u)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind("webkitTransitionEnd"):k(this.aniTime);this.steps=[];this.animating=this.moved=!1},zoom:function(a,c,d,e){var f=d/this.scale;this.options.useTransform&&(this.zoomed=!0,e=void 0===e?200:e,a=a-this.wrapperOffsetLeft-this.x,c=c-this.wrapperOffsetTop-this.y,this.x=a-a*f+this.x,
this.y=c-c*f+this.y,this.scale=d,this.refresh(),this.x=0<this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,this.y=this.y>this.minScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y,this.scroller.style[b+"TransitionDuration"]=e+"ms",this.scroller.style[b+"Transform"]=r+this.x+"px,"+this.y+"px"+s+" scale("+d+")",this.zoomed=!1)},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};"undefined"!==typeof exports?exports.iScroll=e:window.iScroll=e})();
var qq=qq||{};
qq.FileUploader=function(a){this._options={element:null,action:"/server/upload",params:{},allowedExtensions:"jpg png gif jpeg bmp ogg mp3 wav".split(" "),sizeLimit:0,onSubmit:function(){},onComplete:function(){},buttonText:"Upload a file",template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>Drop files here to upload</span></div><div class="qq-upload-button"><div class="qq-upload-button-hightlight"></div><span>'+a.buttonText+'</span></div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-upload-proc"></span><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size">&nbsp;</span><span class="qq-upload-percents">&nbsp;</span><a class="qq-upload-cancel" href="#">x</a><span class="qq-upload-failed-text"></span></li>',
classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",percents:"qq-upload-percents",success:"qq-upload-success",fail:"qq-upload-fail"},messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",emptyError:"{file} is empty, please select files again without it."},
showMessage:function(a){alert(a)}};qq.extend(this._options,a);this._element=this._options.element;if(1!=this._element.nodeType)throw Error("element param of FileUploader should be dom node");this._element.innerHTML=this._options.template;this._filesInProgress=0;this._classes=this._options.classes;this._handler=this._createUploadHandler();this._bindCancelEvent();var b=this;this._button=new qq.UploadButton({element:this._getElement("button"),multiple:qq.UploadHandlerXhr.isSupported(),onChange:function(a){b._onInputChange(a)}});
this._setupDragDrop()};
qq.FileUploader.prototype={setParams:function(a){this._options.params=a},isUploading:function(){return!!this._filesInProgress},_getElement:function(a,b){"string"==typeof a&&(b=a,a=this._element);var c=qq.getByClass(a,this._options.classes[b])[0];if(!c)throw Error("element not found "+b);return c},_error:function(a,b){var c=this._options.messages[a],c=c.replace("{file}",this._formatFileName(b)),c=c.replace("{extensions}",this._options.allowedExtensions.join(", ")),c=c.replace("{sizeLimit}",this._formatSize(this._options.sizeLimit));
this._options.showMessage(c)},_formatFileName:function(a){33<a.length&&(a=a.slice(0,19)+"..."+a.slice(-13));return a},_isAllowedExtension:function(a){var a=-1!==a.indexOf(".")?a.replace(/.*[.]/,"").toLowerCase():"",b=this._options.allowedExtensions;if(!b.length)return!0;for(var c=0;c<b.length;c++)if(b[c].toLowerCase()==a)return!0;return!1},_setupDragDrop:function(){function a(a){var a=a.dataTransfer,b=-1<navigator.userAgent.indexOf("AppleWebKit");return a&&"none"!=a.effectAllowed&&(a.files||!b&&a.types.contains&&
a.types.contains("Files"))}var b=this,c=this._getElement("drop");c.style.display="none";var d;qq.attach(document,"dragenter",function(a){a.preventDefault();a.stopPropagation();a.dataTransfer.dropEffect="none"});qq.attach(document,"dragover",function(e){if(a(e)){d&&clearTimeout(d);if(c==e.target||qq.contains(c,e.target)){var f=e.dataTransfer.effectAllowed;e.dataTransfer.dropEffect="move"==f||"linkMove"==f?"move":"copy";qq.addClass(c,b._classes.dropActive);e.stopPropagation()}else c.style.display="block",
e.dataTransfer.dropEffect="none";e.preventDefault()}});qq.attach(this._element,"dragover",function(e){if(a(e)){d&&clearTimeout(d);if(c==e.target||qq.contains(c,e.target)){var f=e.dataTransfer.effectAllowed;e.dataTransfer.dropEffect="move"==f||"linkMove"==f?"move":"copy";qq.addClass(c,b._classes.dropActive);e.stopPropagation()}else c.style.display="block",e.dataTransfer.dropEffect="none";e.preventDefault()}});qq.attach(document,"dragleave",function(e){a(e)&&(c==e.target||qq.contains(c,e.target)?(qq.removeClass(c,
b._classes.dropActive),e.stopPropagation()):(d&&clearTimeout(d),d=setTimeout(function(){c.style.display="none"},77)))});qq.attach(c,"drop",function(a){c.style.display="none";b._uploadFileList(a.dataTransfer.files);a.preventDefault()})},_createUploadHandler:function(){var a=this,b;b=qq.UploadHandlerXhr.isSupported()?"UploadHandlerXhr":"UploadHandlerForm";return new qq[b]({action:this._options.action,onProgress:function(b,d,e,f){a._updateProgress(b,e,f)},onComplete:function(b,d,e){a._filesInProgress--;
var f=a._getItemByFileId(b);qq.remove(a._getElement(f,"cancel"));qq.remove(a._getElement(f,"spinner"));e.success?qq.addClass(f,a._classes.success):(qq.addClass(f,a._classes.fail),e.error&&a._options.showMessage(e.error));a._options.onComplete(b,d,e)}})},_onInputChange:function(a){this._handler instanceof qq.UploadHandlerXhr?this._uploadFileList(a.files):this._validateFile(a)&&this._uploadFile(a);this._button.reset()},_uploadFileList:function(a){for(var b=!0,c=a.length;c--;)if(!this._validateFile(a[c])){b=
!1;break}if(b)for(c=a.length;c--;)this._uploadFile(a[c])},_uploadFile:function(a){var a=this._handler.add(a),b=this._handler.getName(a);this._options.onSubmit(a,b);this._addToList(a,b);this._handler.upload(a,this._options.params)},_validateFile:function(a){var b,c;a.value?b=a.value.replace(/.*(\/|\\)/,""):(b=null!=a.fileName?a.fileName:a.name,c=null!=a.fileSize?a.fileSize:a.size);if(this._isAllowedExtension(b)){if(0===c)return this._error("emptyError",b),!1;if(c&&this._options.sizeLimit&&c>this._options.sizeLimit)return this._error("sizeError",
b),!1}else return this._error("typeError",b),!1;return!0},_addToList:function(a,b){var c=qq.toElement(this._options.fileTemplate);c.qqFileId=a;var d=this._getElement(c,"file");qq.setText(d,this._formatFileName(b));this._getElement("list").appendChild(c);this._filesInProgress++},_updateProgress:function(a,b,c){var d=this._getItemByFileId(a),a=this._getElement(d,"size"),d=this._getElement(d,"percents");a.style.display="inline";var e=Math.round(100*(b/c)),b=b!=c?this._formatSize(b)+"/"+this._formatSize(c):
this._formatSize(c);qq.setText(d,e+"%");qq.setText(a,b,e)},_formatSize:function(a){var b=-1;do a/=1024,b++;while(99<a);return Math.max(a,0.1).toFixed(1)+"kB MB GB TB PB EB".split(" ")[b]},_getItemByFileId:function(a){for(var b=this._getElement("list").firstChild;b;){if(b.qqFileId==a)return b;b=b.nextSibling}},_bindCancelEvent:function(){var a=this,b=this._getElement("list");qq.attach(b,"click",function(b){var b=b||window.event,d=b.target||b.srcElement;qq.hasClass(d,a._classes.cancel)&&(qq.preventDefault(b),
b=d.parentNode,a._handler.cancel(b.qqFileId),qq.remove(b))})}};qq.UploadButton=function(a){this._options={element:null,multiple:!1,name:"file",onChange:function(){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,a);this._element=this._options.element;qq.css(this._element,{position:"relative",overflow:"HIDDEN",direction:"ltr"});this._input=this._createInput()};
qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){this._input.parentNode&&qq.remove(this._input);qq.removeClass(this._element,this._options.focusClass);this._input=this._createInput()},_createInput:function(){var a=document.createElement("input");this._options.multiple&&a.setAttribute("multiple","multiple");a.setAttribute("type","file");a.setAttribute("name",this._options.name);qq.css(a,{position:"absolute",right:0,bottom:0,zIndex:1,fontSize:"460px",margin:0,padding:0,
cursor:"pointer",opacity:0});this._element.appendChild(a);var b=this;qq.attach(a,"change",function(){b._options.onChange(a)});qq.attach(a,"mouseover",function(){qq.addClass(b._element,b._options.hoverClass)});qq.attach(a,"mouseout",function(){qq.removeClass(b._element,b._options.hoverClass)});qq.attach(a,"focus",function(){qq.addClass(b._element,b._options.focusClass)});qq.attach(a,"blur",function(){qq.removeClass(b._element,b._options.focusClass)});window.attachEvent&&a.setAttribute("tabIndex","-1");
return a}};qq.UploadHandlerForm=function(a){this._options={action:"/upload",onComplete:function(){}};qq.extend(this._options,a);this._inputs={}};
qq.UploadHandlerForm.prototype={add:function(a){a.setAttribute("name","qqfile");var b="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[b]=a;a.parentNode&&qq.remove(a);return b},upload:function(a,b){var c=this._inputs[a];if(!c)throw Error("file with passed id was not added, or already uploaded or cancelled");var d=this.getName(a),e=this._createIframe(a),f=this._createForm(e,b);f.appendChild(c);var g=this;this._attachLoadEvent(e,function(){g._options.onComplete(a,d,g._getIframeContentJSON(e));
delete g._inputs[a];setTimeout(function(){qq.remove(e)},1)});f.submit();qq.remove(f);return a},cancel:function(a){a in this._inputs&&delete this._inputs[a];if(a=document.getElementById(a))a.setAttribute("src","javascript:false;"),qq.remove(a)},getName:function(a){return this._inputs[a].value.replace(/.*(\/|\\)/,"")},_attachLoadEvent:function(a,b){qq.attach(a,"load",function(){a.parentNode&&(!a.contentDocument||!(a.contentDocument.body&&"false"==a.contentDocument.body.innerHTML))&&b()})},_getIframeContentJSON:function(a){var a=
a.contentDocument?a.contentDocument:a.contentWindow.document,b;try{b=eval("("+a.body.innerHTML+")")}catch(c){b={}}return b},_createIframe:function(a){var b=qq.toElement('<iframe src="javascript:false;" name="'+a+'" />');b.setAttribute("id",a);b.style.display="none";document.body.appendChild(b);return b},_createForm:function(a,b){var c=qq.toElement('<form method="post" enctype="multipart/form-data"></form>'),d="?",e;for(e in b)d+="&"+e+"="+encodeURIComponent(b[e]);c.setAttribute("action",this._options.action+
d);c.setAttribute("target",a.name);c.style.display="none";document.body.appendChild(c);return c}};qq.UploadHandlerXhr=function(a){this._options={action:"/upload",onProgress:function(){},onComplete:function(){}};qq.extend(this._options,a);this._files=[];this._xhrs=[]};qq.UploadHandlerXhr.isSupported=function(){return"undefined"!=typeof File&&"undefined"!=typeof(new XMLHttpRequest).upload};
qq.UploadHandlerXhr.prototype={add:function(a){return this._files.push(a)-1},upload:function(a,b){var c=this._files[a],d=this.getName(a),e=this.getSize(a);if(!c)throw Error("file with passed id was not added, or already uploaded or cancelled");var f=this._xhrs[a]=new XMLHttpRequest,g=this;f.upload.onprogress=function(b){if(b.lengthComputable)g._options.onProgress(a,d,b.loaded,b.total)};f.onreadystatechange=function(){if(g._files[a]&&4==f.readyState){g._options.onProgress(a,d,e,e);if(200==f.status){var b;
try{b=eval("("+f.responseText+")")}catch(c){b={}}g._options.onComplete(a,d,b)}else g._options.onComplete(a,d,{});g._files[a]=null;g._xhrs[a]=null}};var i="?qqfile="+encodeURIComponent(d),j;for(j in b)i+="&"+j+"="+encodeURIComponent(b[j]);f.open("POST",this._options.action+i,!0);f.send(c)},cancel:function(a){this._files[a]=null;this._xhrs[a]&&(this._xhrs[a].abort(),this._xhrs[a]=null)},getName:function(a){a=this._files[a];return null!=a.fileName?a.fileName:a.name},getSize:function(a){a=this._files[a];
return null!=a.fileSize?a.fileSize:a.size}};qq=qq||{};qq.extend=function(a,b){for(var c in b)a[c]=b[c]};qq.getUniqueId=function(){var a=0;return function(){return a++}}();qq.attach=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)};qq.detach=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.attachEvent&&a.detachEvent("on"+b,c)};qq.preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1};
qq.insertBefore=function(a,b){b.parentNode.insertBefore(a,b)};qq.remove=function(a){a.parentNode.removeChild(a)};qq.contains=function(a,b){return a.contains?a.contains(b):!!(b.compareDocumentPosition(a)&8)};qq.toElement=function(){var a=document.createElement("div");return function(b){a.innerHTML=b;b=a.firstChild;a.removeChild(b);return b}}();
qq.css=function(a,b){null!=b.opacity&&("string"!=typeof a.style.opacity&&"undefined"!=typeof a.filters)&&(b.filter="alpha(opacity="+Math.round(100*b.opacity)+")");qq.extend(a.style,b)};qq.hasClass=function(a,b){return RegExp("(^| )"+b+"( |$)").test(a.className)};qq.addClass=function(a,b){qq.hasClass(a,b)||(a.className+=" "+b)};qq.removeClass=function(a,b){a.className=a.className.replace(RegExp("(^| )"+b+"( |$)")," ").replace(/^\s+|\s+$/g,"")};
qq.setText=function(a,b,c){a.innerText=b;a.textContent=b;c&&$(a).parent().find(".qq-upload-proc").css("width",c+"%")};qq.children=function(a){for(var b=[],a=a.firstChild;a;)1==a.nodeType&&b.push(a),a=a.nextSibling;return b};qq.getByClass=function(a,b){if(a.getElementsByClassName)return a.getElementsByClassName(b);if(a.querySelectorAll)return a.querySelectorAll("."+b);for(var c=[],d=a.getElementsByTagName("*"),e=d.length,f=0;f<e;f++)qq.hasClass(d[f],b)&&c.push(d[f]);return c};Mighty.require("plugins._menu._Menu").require("plugins._plugin._Plugin").require("plugins.addon.Addon").require("plugins.branch.Branch").require("plugins.brush.Brush").require("plugins.component.Component").require("plugins.deploy.Deploy").require("plugins.entity.Entity").require("plugins.i18n.i18n").require("plugins.multiImport.MultiImport").require("plugins.plugin.Plugin").require("plugins.project.Project").require("plugins.sideMenu.SideMenu").require("plugins.sound.Sound").require("plugins.texture.Texture").require("plugins.topMenus.TopMenus").require("plugins.sourceEditor.SourceEditor").require("plugins.fastUpload.FastUpload").requireFile("js/i18n.js");
Mighty.namespace("plugins._menu");
Mighty(Mighty.plugins._Menu=Mighty.plugins._menu._Menu=function(a){this.content=a},{content:null,core:1,_menus:[],registeredMenus:{},_init:function(){this._menus.push(this);this.ui=this.content.ui;this.buildMenu()},_setActive:function(a,b){var c=$(a).data("clickid"),d=$(a).data("action");this.setActiveIcon(a);if(void 0===c&&void 0===d)return!1;this._reset(d);b||this.content.setAction(d);return!0},setActiveIcon:function(a){for(var b=0;b<this._menus.length;b++)this._menus[b].menu.find("a.active").removeClass("active");$(a).addClass("active")},
registerMenu:function(a,b){a.index=void 0==a.index?void 0==b?99:b:a.index;var c=a[Object.keys(a)[0]];c.title=c.title||c.action;c.link=c.link||c.link;this._addMenuItem(a);return a},_addMenuItem:function(a){this.menus.push(a)},removeMenuItem:function(a){for(var b=0,c=0;c<this.menus.length;c++)this.menus[c]===a&&(this.menus.splice(c,1),b=1);b&&this.buildMenu()},_reset:function(a){var b=this.content.plugins[this.content.action];b&&(a!==b.name&&void 0!==b.deactivate)&&b.deactivate.call(b)},menuItemClick:function(a,
b){b.preventDefault();var c=$(a).data("clickid");if(void 0===c)return!1;this.content.ui.$search.val("");c=this.callbacks[c](b);b.cancelBubble=!0;return c},templates:{menu:function(a){var b="";"undefined"!==typeof a._clickID&&(b='data-clickID="'+a._clickID+'"');var c="";a.id&&(c='id="'+a.id+'"');return'\t\t\t\t\t\t<a href="#'+a.link+'" '+c+" "+b+' data-action="'+a.action+'">'+a.title+"</a>\t\t\t\t\t"}},deInit:function(){for(var a in this.registeredMenus)delete this.registeredMenus[a];this._menus.length=
0;this.menu&&this.menu.empty();this.menus&&(this.menus.length=0)},_buildMenu:function(){var a=this,b="";this.menus.sort(function(a,b){return a.index-b.index});for(var c=0;c<this.menus.length;c++)b+=this.parseActions(this.menus[c],this.templates.menu);this.menu.empty().append(b);this.menu.off("click").on("click",function(b){a.menuItemClick(b.target,b)||a._setActive(b.target)})},buildMenu:function(){this._buildMenu()},callbacks:[],registerCB:function(a){return this.callbacks.push(a)-1},parseActions:function(a,
b,c){"function"!==typeof b&&(b=Templates[b]);var d="",e;for(e in a)if("_submenu"===e)d+=this.parseActions(a[e],b,1);else if("object"===typeof a[e]){var f="";"function"===typeof a[e].click&&(a[e]._clickID=this.registerCB(a[e].click));f=a[e].action;d+='<li class="'+f+'">'+b(a[e])+this.parseActions(a[e],b)+"</li>"}!c&&""!==d&&(d="<ul>"+d+"</ul>");return d}});Mighty.namespace("plugin");Mighty.namespace("plugins._plugin");
Mighty(Mighty.plugins._Plugin=Mighty.EditorPlugin=Mighty.plugins._plugin._Plugin=function(a){this.content=a},{core:1,template:"iconView",requires:[],inputs:null,buttons:{},emptyList:!0,templateParams:null,init:function(){},start:function(a){this._start(a)},_start:function(a){this._setNewItemTitle();a&&a()},_clickItem:function(a){this.content.activeItem=this.loadDefaultSettings(a,this.createMeta(a))},mkItem:function(){var a=Tools.clone(this.defaultItem);return this._loadDefaultSettings(a,this.createMeta(a),
!0)},clickItem:function(a,b){this.activeItem=a;this._clickItem(a,b)},_search:function(a,b){return a.test(b.name)},search:function(a,b){return this._search(a,b)},enginePlugin:null,createMeta:function(a){return this._createMeta(a)},_createMeta:function(a){var b=null;if(this.inputs)b=this.inputs;else var b="",b=a&&a.editor&&a.editor.plugin?a.editor.plugin:this.enginePlugin||this.name,c=this,b=Tools.createMeta(a,b,function(){c.clickItem(Tools.mergeObject(this.otito.object,a))});return b},_loadDefaultSettings:function(a,
b,c){b||this.createMeta&&(b=this.createMeta(a));b=b||Tools.parseImportDef(this.name)||Tools.clone(cfg.defaultInputs);void 0===b.editor&&(b.editor=cfg.editorData);if(c)a=new Otito(a,b);else var d=this.content.ui,a=new Otito(a,b,function(){d.beautifyInputs()});return this.content.activeItem=a},_drawInputs:function(a){var b=this;this.content.ui.$toSave.empty();a.append(this.content.ui.$toSave[0]);this.addButtonsBlock(a.object);var c=0,d=this.content.ui.$toSave.find("*:input").not("*:[type='hidden'],option");
d.on("mousedown",function(){"OPTION"==this.nodeType&&$(this).parent();for(var a=0;a<d.length;a++)if(this==d[a]){c=a;break}});d.eq(c).focus();this.content.ui.$toSave.off("keydown").on("keydown",function(e){switch(e.which){case 13:if("TEXTAREA"==e.target.tagName)break;b.saveItem(a.object);break;case 9:e.preventDefault&&(e.preventDefault(),e.stopImmediatePropagation()),e.shiftKey?(--c,0>c&&(c=d.length-1)):(++c,c>=d.length&&(c=0)),d.eq(c).is(":visible")||d.eq(c).closest(".folder").addClass("active"),
d.eq(c).focus()}});return a},loadDefaultSettings:function(a,b){return this._drawInputs(this._loadDefaultSettings(a,b))},addButtonsBlock:function(a){var b=this,c={};void 0===this.buttons.noSave?c._save=function(){b.saveItem(a)}:c._nosave=!0;void 0===this.buttons.noSaveAsNew&&!isNaN(parseInt(a.id))?c._saveAsNew=function(){var c=Tools.clone(a);c.id=null;b.saveItem(c)}:c._nosaveas=!0;void 0===this.buttons.noDelete&&!isNaN(parseInt(a.id))?c._delete=function(){b.deleteItem(a)}:c._nodelete=!0;"function"!==
typeof this.advance||isNaN(parseInt(a.id))||this.buttons.noAdvance?c._noadvance=!0:(c._advance=function(){b.advance(a)},c.advanceTitle="btn_advance_"+this.name);this.content.ui.$toSave.append(Templates.saveBlock(c))},_saveItem:function(a,b){var c=this;a.editor.plugin=this.enginePlugin||this.name;if(!a.id&&a.name){var d=!1,e=this.content.buffer[this.name],f;for(f in e)if(e[f].name==a.name){d=!0;break}d&&(d=a.name.substring(a.name.length-1),d=parseInt(d),isNaN(d)?a.name+="1":(d++,a.name=a.name.substring(0,
a.name.length-1)+d))}this.content.load.saveItem(a,function(a){c.content.activeGroup[c.name]=a[0].editor.group;c.content.buffer[c.name]||(c.content.buffer[c.name]={});c.content.buffer[c.name][a[0].id]=a[0];c.content.action===c.name&&(c.content.ui.setView(a[0].id,!0),c.clickItem(a[0]));c.createList();b&&b(a)},this.name)},saveItem:function(a){this._saveItem(a)},accumulator:[],_collect:function(a){this.accumulator.push(a)},_multiSave:function(a,b){var c=this;this.accumulator.length?this.content.load.multiSaveItems(this.accumulator,
function(){c.accumulator.length=0;"function"===typeof a&&a(0)},b):"function"===typeof a&&a(1)},deleteItem:function(a,b,c){this._deleteItem(a,b,c)},itemDeleted:function(a,b){b&&this.content.ui.refreshView()},itemChanged:function(a){this.clickItem(a)},_deleteItem:function(a,b,c){var d=this;(c||confirm("Are you sure?"))&&this.content.load.delItem(a,function(){d.content.getItems(b);d.content.ui.removeSettings()})},_newAsset:function(a){var b=0,c=0,d=0;void 0==this.buttons.noDelete&&(b=1);void 0==this.buttons.noSaveAsNew&&
(c=1);void 0==this.buttons.noAdvance&&(d=1);this.buttons.noDelete=1;this.buttons.noSaveAsNew=1;this.buttons.noAdvance=1;this._clickItem(a);b&&delete this.buttons.noDelete;c&&delete this.buttons.noSaveAsNew;d&&delete this.buttons.noAdvance},newAsset:function(a){this.content.ui.setView();this._newAsset(a)},_getItems:function(a){var b=this.content.buffer[this.name],c=typeof a;this.content.action!=this.name?"function"==c&&a(b):(this._setNewItemTitle(),this.getDeps(function(){"function"==c&&a(b)}))},deInit:function(){try{this.deactivate()}catch(a){}},
deactivate:function(){},getItems:function(a){this._getItems(a)},__newAssetHidden:0,_setNewItemTitle:function(){this.content.ui.$newAssetButton[0].innerHTML=_(this.newAssetTitle||"btn_new "+this.name);this.content.ui.$newAssetButton.show();this.noNewAsset&&(this.content.ui.$newAssetButton.hide(),this.__newAssetHidden=1)},_checkItems:function(a){if(!a||!this.loadDefaultSettings)return 0;var b=0,c;for(c in a){var d=a[c],e=null;this.createMeta&&(e=this.createMeta(d));var f;try{f=this._loadDefaultSettings(a[c],
e,1).object}catch(g){continue}a[c].editor&&a[c].editor.group&&(f.editor.group=a[c].editor.group);isObjectsEqual(d,f)||(this._collect(f),this.content.buffer[this.name][c]=f,b=1)}b&&this._multiSave(function(){},this.name)},getDeps:function(a){var b={};this.collectDeps(b);var c=[],d;for(d in b)this.name!=d&&c.push(d);0<c.length?this.loadDeps(c,function(){"function"===typeof a&&a()}):"function"===typeof a&&a()},collectDeps:function(a){var b=this.content,c=b.plugins[this.name].requires;if(void 0===a[this.name]){a[this.name]=
1;for(var d=0;d<c.length;d++)b.plugins[c[d]]&&this.collectDeps.call(b.plugins[c[d]],a)}},loadDeps:function(a,b){for(var c=a.length,d=0;d<a.length;d++)this.content.plugins[a[d]].getItems(function(a){c--;0==c&&b(a)})},createList:function(a){window.Lists[this.name]={};void 0==a&&(a=this.content.buffer[this.name]);this.emptyList&&(window.Lists[this.name][0]="");var b=null;if(Array.isArray(a))b=a;else{var b=[],c;for(c in a)b.push(a[c])}for(a=0;a<b.length;a++)window.Lists[this.name][b[a].id]=b[a].name},
requiresList:{}});Mighty.namespace("plugins.addon");
Mighty(Mighty.plugins.Addon=Mighty.plugins.addon.Addon=function(a){this.content=a},{core:1,"extends":["_plugin"],requires:["Map"],noNewAsset:1,start:function(a){this.noNewAsset=1;this._start(a);this.noNewAsset=0},register:function(){this.content.plugins.SideMenu.registerMenu({Addons:{title:"Addons",action:"Addon"}},6)},clickItem:function(a){var b=this.createMeta(a);this.loadDefaultSettings(a,b)},createMeta:function(a){var b=Tools.clone(cfg.defaultInputs);a||(a={name:"",editor:{}});b=Tools.mergeObject(b,
Tools.createAddonMeta(a));b.name.readonly="readonly";return b},getItems:function(a){this.nameBuffer={};this._getItems(function(b){a&&a(b)})},checkItems:function(){}}).extend("plugins._plugin._Plugin");Mighty.namespace("plugins.branch");Mighty.requireFile("js/plugins/branch/branch.tpl.js");
Mighty.extend("plugins._plugin._Plugin")(Mighty.plugins.Branch=Mighty.plugins.branch.Branch=function(){this.inputs={id:{_type:"hidden"},name:{value:"",placeholder:_("Branch Name"),_type:"string"},parent:{_type:"list",_use:"Lists.Branch",_reverse:1}}},{content:null,core:1,defaultBranch:{id:1,name:"root"},emptyList:!1,register:function(){var a=this;this.content.plugins.FileMenu.registerMenu({branches:{title:"Branches",action:"Branch",id:"Branch",click:function(){a.click()}}},2)},items:null,click:function(){this.loadDefaultSettings(this.content.projectInfo.branchId,
this.Inputs)},getItems:function(a){var b=this;this.content.load.getBranchTree(function(c){b.items=c;b.parseItems(c);"function"===typeof a&&a()})},parseItems:function(a){this.addSavedBranch({id:0,name:"",sub:a});Lists[this.name]={};for(var b in this.savedBranches)"0"!=this.savedBranches[b].id&&(Lists[this.name][this.savedBranches[b].id]=this.savedBranches[b].name);this.content.buffer[this.name]=this.savedBranches},isInTree:function(a){this.parseItems(this.items);var b=this.content.projectInfo.branchId;
if(b==a)return 1;for(var c=this.content.buffer[this.name];b&&b!=c[b].parent;)if(b=c[b].parent,a==b)return 1;return 0},setView:function(){this.showTree();this.content.ui.hideGroups();this._setNewItemTitle()},deInit:function(){this.init()},showTree:function(){var a={id:0,name:"",sub:this.items};this.addSavedBranch(a);a=Templates.branches.branchHolder(a.sub[0],this.content.projectInfo.branchId);this.content.ui.mainView(a);this.setUpBranchesInteractive()},savedBranches:{},addSavedBranch:function(a,b){if(a){b=
b||1;a.sub||(a.sub=[]);for(var c=0;c<a.sub.length;c++)this.addSavedBranch(a.sub[c],a.id);this.savedBranches[a.id]=a;this.savedBranches[a.id].parent=b}},setUpBranchesInteractive:function(){var a=this;$(".node  > .title > .text").droppable({hoverClass:"hightlight",accept:".title > span.text",tolerance:"pointer",drop:function(b,c){var d=$(this).data("id"),e=$(c.draggable[0]).data("id");a.savedBranches[e].parent==d&&(d=a.savedBranches[d].parent);if(e==d)a.showTree();else{for(var h=a.savedBranches[d];h&&
h.parent!=h.id;){if(h.id==e||h.parent==e)return console.warn("Branches::CheckRecursivity -> found (breaking)",h.id,e),a.showTree(),!1;h=a.savedBranches[h.parent]}a.content.load.updateBranchById(e,d,a.savedBranches[e].name||cfg.defaultBranchName,function(b){a.items=b;a.showTree()})}}});$(".node > .title > .text").draggable({revert:"invalid",tolerance:"pointer",appendTo:"body",distance:20});$(".node > .title").click(function(){a.clickItem(this)});var b=$(".nodeWrap"),c=b.find(".active");b.draggable();
if(c.length){var d=c.offset(),e=b.parent().width();d.left=-d.left+0.5*(e+c.width());d.top=-d.top+0.1*b.parent().height();b.offset(d)}a.initZoom(b)},initZoom:function(){var a=1,b=$(".branch .zoom");b.height();var c=function(c){var e=c;c.originalEvent&&(e=c.originalEvent);c=a+=0.0010*(e.wheelDelta||40*-e.detail);e.preventDefault&&!c&&e.preventDefault();e.preventBubble&&!c&&e.preventBubble(e);1<a?a=1:0.5>a&&(a=0.5);window.zoom=a;e=100/a;window.navigator&&(-1<window.navigator.userAgent.indexOf("Firefox")&&
(b[0].style.cssText="-moz-transform: scale("+a+"); -moz-transform-origin: 0 0; overflow: visible; width: "+e+"%"),-1<window.navigator.userAgent.indexOf("WebKit")&&(b[0].style.cssText="-webkit-transform: scale("+a+"); -webkit-transform-origin: 0 0; overflow: visible; width: "+e+"%; height: "+e+"%;"),-1<window.navigator.userAgent.indexOf("MSIE")&&(b[0].style.width=b.width()/a+"px",b[0].style.height=b.height()/a+"px",b[0].style.zoom=a));return c};b.on("mousewheel",c);b.on("DOMMouseScroll",c)},clickItem:function(a,
b){var c=b?b:$(a).data("id");$(".node > .title.active").removeClass("active");$(a).addClass("active");this.content.setActiveBranch(c);this.loadDefaultSettings(this.savedBranches[c],this.Inputs)},saveItem:function(a){var b=this,c=a.parent;a.id||(c=this.content.projectInfo.branchId);b.content.load.updateBranchById(a.id,c,a.name,function(a){b.items=a;b.showTree()})},newAsset:function(){this._newAsset()},deleteItem:function(a){var b=this;confirm("Are you sure?")&&b.content.load.delBranch(a.id,function(){b.getItems(function(){b.content.setActiveBranch(a.parent);
b.loadDefaultSettings(b.savedBranches[a.parent],b.Inputs);b.setView()})})},inputs:null});
Templates.branches={branchHolder:function(a,b,c,d){return'<div class="branch"><div class="zoom"><div class="drag"><div class="nodeWrap">'+this.branchTree(a,b,c,d,1)+"</div></div></div></div>"},branchTree:function(a,b,c,d,e){for(var f="",g="",c=c||0,d=d||0,i="",j="",h=0;h<a.sub.length;h++)f+=this.branchTree(a.sub[h],b,a.sub.length,h);a.id==b&&(j=" active");e?g+=" root":i='<span class="bg"></span>';a.sub.length&&(g+=" folder");0===d&&(g+=" first");d===c-1&&(g+=" last");return'<span class="node '+g+
'" data-id='+a.id+' title="BranchId '+a.id+'">'+i+'<span class="title '+j+'" data-id='+a.id+'><span class="hideBck"></span><span data-id='+a.id+' class="text">'+a.name+"</span></span><br />"+f+"</span>"}};Mighty.namespace("plugins.brush");
Mighty(Mighty.plugins.Brush=Mighty.plugins.brush.Brush=function(){this.defaultItem={id:null,name:"",type:Import.Brush.Type.BASIC}},{name:"Brush",core:1,"extends":["_plugin"],requires:["Texture"],buttons:{},register:function(){this.content.plugins.SideMenu.registerMenu({Brush:{action:"Brush",title:"Brushes"}},2)},brushFromTexture:function(a){var b=this._loadDefaultSettings({id:null,name:a.name,texture:a.id,type:Import.Brush.Type.BASIC},null,1);b.object.editor||(b.object.editor={});b.object.editor.group=
a.editor.group;this.saveItem(b.object)},advance:function(a){this.content.plugins.Entity.entityFromBrush(a);this.content.setAction("Entity")},clickItem:function(a){var b=this.createMeta(a);this.loadDefaultSettings(a,b)},newAsset:function(){this.content.ui.setView();this.buttons.noDelete=!0;this.buttons.noSaveAsNew=!0;this.clickItem(Tools.clone(this.defaultItem));delete this.buttons.noDelete;delete this.buttons.noSaveAsNew},getItems:function(a){var b=this;this._getItems(function(c){"function"===typeof a&&
a(c);b.createList(c,!0)})},getNewStages:function(a,b){for(var c=[],d=0;d<b.length;d++){var e=1;if(void 0==a)c.push(null);else{for(var f=0;f<a.length;f++)if(a[f]&&b[d].type._valueOverride===a[f].type){c.push(a[f]);e=0;break}e&&(a[f]?c.push(a[f]):c.push(null))}}return c}}).extend("plugins._plugin._Plugin");Mighty.namespace("plugins.component");Mighty.require("plugins.entity.Entity");
Mighty.extend("plugins._plugin._Plugin")(Mighty.plugins.Component=Mighty.plugins.component.Component=function(){},{core:1,requires:["Entity"],buttons:{},register:function(){this.content.plugins.SideMenu.registerMenu({Component:{title:"Component",action:"Component",link:"Component"}},3)},clickItem:function(a){var b=this.createMeta(a);this.loadDefaultSettings(a,b)},newAsset:function(){this.content.ui.setView();this.buttons.noDelete=!0;this.buttons.noSaveAsNew=!0;this.clickItem({id:null,name:"",type:Import[this.name].Type.BASIC});
delete this.buttons.noDelete;delete this.buttons.noSaveAsNew},getItems:function(a){var b=this;this._getItems(function(c){b.createList(c,!0);"function"===typeof a&&a(c)})}});Mighty.namespace("plugins.entity");Mighty.require("plugins.component.Component").require("plugins.brush.Brush");
Mighty.extend("plugins._plugin._Plugin")(Mighty.plugins.Entity=Mighty.plugins.entity.Entity=function(){this.core=1;this.defaultItem={id:null,type:Import.Entity.Type.GEOMETRY}},{name:"Entity",buttons:{},entityFromBrush:function(a){var b=this._loadDefaultSettings({id:null,name:a.name,brush:a.id,type:Import.Entity.Type.GEOMETRY});b.object.editor||(b.object.editor={});b.object.editor.group=a.editor.group;this.saveItem(b.object);return b},register:function(){this.content.plugins.SideMenu.registerMenu({sample:{title:"Entity",
action:"Entity",link:"entity"}},4)},newAsset:function(){this.content.ui.setView();this.buttons.noDelete=!0;this.buttons.noSaveAsNew=!0;this.clickItem(Tools.clone(this.defaultItem));delete this.buttons.noDelete;delete this.buttons.noSaveAsNew},clickItem:function(a){var b=this.createMeta(a);this.loadDefaultSettings(a,b)},getItems:function(a){var b=this;this._getItems(function(c){"function"===typeof a&&a(c);b.createList(c,!0)})}});Mighty.namespace("plugins.component");Mighty.require("plugins.entity.Entity");
Mighty.extend("plugins._plugin._Plugin")(Mighty.plugins.Component=Mighty.plugins.component.Component=function(){},{core:1,requires:["Entity"],buttons:{},register:function(){this.content.plugins.SideMenu.registerMenu({Component:{title:"Component",action:"Component",link:"Component"}},3)},clickItem:function(a){var b=this.createMeta(a);this.loadDefaultSettings(a,b)},newAsset:function(){this.content.ui.setView();this.buttons.noDelete=!0;this.buttons.noSaveAsNew=!0;this.clickItem({id:null,name:"",type:Import[this.name].Type.BASIC});
delete this.buttons.noDelete;delete this.buttons.noSaveAsNew},getItems:function(a){var b=this;this._getItems(function(c){b.createList(c,!0);"function"===typeof a&&a(c)})}});Mighty.namespace("plugins.deploy");
Mighty(Mighty.plugins.Deploy=Mighty.plugins.deploy.Deploy=function(){this.inputs={id:{_type:"hidden"},name:{_type:"text"},branch:{_type:"list",_use:"Lists.Branch",_reverse:1},full:{_type:"hidden",value:1},script:{_type:"text",value:"",placeholder:"",title:_("executes program in release {path}, after deploy finished.")},releasePath:{_type:"text",value:"",placeholder:"",title:_("release path")},zipFiles:{_type:"bool",value:!1},cocoonJS:{_type:"bool",value:!1},useClosureCompiler:{_type:"bool",value:!1,
onchange:function(){this.otito.refresh()}},audio:{mp3:!1,ogg:!0,m4a:!0,wav:!1},closureCompiler:{_make:function(a,b){return!b.object||!b.object.useClosureCompiler?{_type:"hidden",value:""}:{compilation_level:{_type:"list",use:{WHITESPACE_ONLY:"WHITESPACE_ONLY",SIMPLE_OPTIMIZATIONS:"SIMPLE_OPTIMIZATIONS"},_value:"SIMPLE_OPTIMIZATIONS"},language_in:{_type:"list",use:{ECMASCRIPT3:"ECMASCRIPT3",ECMASCRIPT5:"ECMASCRIPT5",ECMASCRIPT5_STRICT:"ECMASCRIPT5_STRICT"},_value:"ECMASCRIPT5_STRICT"},compilerFlags:{_type:"textarea",
value:""}}}}}},{items:[],myMeny:null,register:function(){this.myMenu=this.content.plugins.DeployMenu;this.myMenu.registerMenu({deploy:{title:"Deploy",action:"Deploy",id:"deploy",_submenu:this.items}},2)},init:function(){},getItems:function(a){var b=this;this._getItems(function(c){a&&a(c);b.rebuildMenu(c)})},clickItem:function(a,b){a&&a.editor&&(a.editor.branch="1");this._clickItem(a,b)},makeItem:function(a){var b=this;return{action:"Deploy",title:a.name,click:function(){b.content.load.deploy(function(a){if(a.release){var d=
a.release.substring(a.release.indexOf(b.content.activeProject)+b.content.activeProject.length+1),e=MightyEditor.plugins.Map.basePath,e=e.substring(0,e.indexOf("index.html")),d=e+d+"/index.html";a.release+='<br /><a href="'+d+'" target="_blank">'+d+"</a>"}b.content.ui.deployReport(a)},a);return!0}}},refresh:function(){this.rebuildMenu(this.content.buffer.Deploy)},deleteItem:function(a){var b=this;this._deleteItem(a,function(a){cb&&cb(a);b.rebuildMenu(b.content.buffer.Deploy)})},saveItem:function(a){a.editor.__new__branch=
1;a.editor.branch=1;this._saveItem(a)},rebuildMenu:function(a){this.items.length=0;for(var b in a)this.items.push(this.makeItem(a[b]));this.items.sort(function(a,b){return a.title>b.title});this.myMenu.buildMenu()},newAsset:function(){this.clickItem()},inputs:null}).extend("plugins._plugin._Plugin");Mighty.namespace("plugins.i18n");
Mighty(Mighty.plugins.i18n=Mighty.plugins.i18n.i18n=function(){this.core=1;this.template="tableView"},{core:1,buttons:{noSaveAsNew:!0},search:function(a,b){for(var c in b)if("editor"!=c&&a.test(b[c]))return!0;return a.test(b.name)},register:function(){this.content.plugins.SideMenu.registerMenu({i18n:{title:"Localization",action:"i18n",link:"i18n"}},7)}}).extend("plugins._plugin._Plugin");Mighty.namespace("plugins.multiImport");Mighty.require("plugins.texture.Texture").require("plugins.brush.Brush").requireFile("js/plugins/multiImport/templates.js");
Mighty.extend("plugins._plugin._Plugin")(Mighty.plugins.MultiImport=Mighty.plugins.multiImport.MultiImport=function(){this.core=1},{register:function(){this.content.plugins.FileMenu.registerMenu({sample:{title:"Multi Import",action:"MultiImport",id:"MultiImport"}},3)},start:function(){var a=this;if(this.content.demoMode)this.content.ui.showError("disabled_in_demo","",function(){a.content.setAction("Texture")});else{var b={},c;for(c in Lists.Texture)"0"!=c&&(b[c]=Lists.Texture[c]);var d=$(Templates.select(b));
d.on("change",function(){});var e=$(Templates.select(Lists.Brush));e.on("change",function(){});b=$(Templates.multiImport.windowContent());b.find(".texture").prepend(d);b.find(".brush").prepend(e);var f=b.find(".group input"),g=b.dialog({title:_("Multi Import"),buttons:[{text:_("btn_done"),click:function(){$(this).dialog("close")}}],close:function(){g.remove();a.content.setAction("Texture")},width:"80%",top:"50px",minHeight:200,height:"auto",maxHeight:window.innerHeight-200,position:["center",100]});
new qq.FileUploader({element:g.find(".upload:first")[0],allowedExtensions:cfg.imageExtensions,action:cfg.uploadFile,buttonText:"",params:{project:a.content.activeProject,action:"itemFile"},onComplete:function(b,c,g){if(g){var m=g.file.split("/").pop(),m=m.split(".").shift(),b=d.val(),k=e.val(),b=Tools.clone(a.content.buffer.Texture[b]);b.id=null;b.image=c;b.editor.group=f.val();b.name=m;a.content.plugins.Texture.saveItem(b,function(b){if(!parseInt(k)||"null"==k)a.content.setAction("Texture");else{var c=
Tools.clone(a.content.buffer.Brush[k]);c.id=null;c.texture=b[0].id;c.editor.group=f.val();c.name=m;a.content.plugins.Brush.saveItem(c,function(){a.content.setAction("Texture")})}})}}});$(".qq-upload-button").append(Templates.button({text:_("btn_click_to_upload")}))}}});Mighty.namespace("plugins.texture");
Mighty(Mighty.plugins.Texture=Mighty.plugins.texture.Texture=function(){this.core=1;this.defaultItem={type:Import.Resource.Type.TEXTURE}},{core:1,"extends":["_plugin"],menuItem:null,enginePlugin:"Resource",register:function(){this.menuItem=this.content.plugins.SideMenu.registerMenu({textures:{title:"Textures",action:"Texture"}},0)},newAsset:function(){this._newAsset(Tools.clone(this.defaultItem))},advance:function(a){this.content.plugins.Brush.brushFromTexture(a);this.content.setAction("Brush")},
getItems:function(a){var b=this;this._getItems(function(c){"function"===typeof a&&a(c);b.createList(c,!0)})},saveItem:function(a,b){"null"==a.combine&&delete a.combine;var c=this,d=new Image;d.onload=function(){a.width=this.width;a.height=this.height;if(!a.name||""==a.name){var d=a.image.split(".");d.pop();a.name=d.join(".")}c._saveItem(a,b)};d.src=this.content.uploadPath+"/"+a.image}}).extend("plugins._plugin._Plugin");
Templates.multiImport={windowContent:function(){return'\t\t\t<div id="multiImport">\t\t\t\t<div class="input"><span class="label">'+_("label_texture_template")+'</span><span class="texture"></span></div>\t\t\t\t<div class="input"><span class="label">'+_("label_brush_template")+'</span><span class="brush"></span><span style="margin-left: 20px">'+_("label_leave_blank_to_skip")+'</span></div>\t\t\t\t<div class="input"><span class="label">'+_("label_group")+'</span><span class="group"><input type="text" value="import" /></span></div>\t\t\t\t<div class="upload"></div>\t\t\t</div>\t\t'}};
Mighty.namespace("plugins.plugin");Mighty.require("plugins.map.Map");
Mighty.extend("plugins._plugin._Plugin")(Mighty.plugins.Plugin=Mighty.plugins.plugin.Plugin=function(){this.core=1},{core:1,noNewAsset:1,buttons:{noSaveAsNew:!0},start:function(a){this.noNewAsset=1;this._start(a);this.noNewAsset=0},search:function(a,b){for(var c in b)if(!("editor"==c||"useInEditor"==c)&&a.test(c))return!0;return a.test(b.name)},register:function(){this.content.plugins.SideMenu.registerMenu({Plugins:{title:"Plugins",action:"Plugin"}},6);this.nameBuffer={}},clickItem:function(a){var b=
this.createMeta(a);this.loadDefaultSettings(a,b)},createMeta:function(a){var b=Tools.clone(cfg.defaultInputs);a||(a={name:"",editor:{}});b=Tools.createPluginMeta(a,"Cfg");b.name.readonly="readonly";"Core"==a.editor.group&&(b.disabled||(b.disabled={_type:"bool",value:!1}),b.disabled._type="hidden",b.useInEditor||(b.useInEditor={_type:"bool",value:!0}),a.disabled=!1,a.useInEditor=!0,b.useInEditor._type="hidden");return b},getItems:function(a){this.nameBuffer={};this._getItems(function(b){a&&a(b)})},
checkItems:function(a,b){for(var c=this,d=0;d<a.length;d++)if(a[d].editor.needSave){delete a[d].editor.needSave;var e=this.createMeta(a[d]),e=this._loadDefaultSettings(a[d],e,!0);this._collect(e.object)}this._multiSave(function(a){a||c.content.load.deploy(function(){},null,1)},b)}});Mighty.namespace("plugins.map");Mighty.require("plugins.entity.Entity").requireFile("js/plugins/map/Map.tpl.js");
Mighty.extend("plugins._plugin._Plugin")(Mighty.plugins.Map=Mighty.plugins.map.Map=function(){this.core=1},{scrollbar:null,buttons:{noSaveAsNew:!0},register:function(){this.content.plugins.SideMenu.registerMenu({map:{action:this.name}},9)},emptyList:!1,name:"Map",port:0,setPort:function(a){var b=window.location;a?(this.basePath=b.protocol+"//"+b.hostname+":"+a+"/index.html",this.content.ui.$playGame.attr("href",this.basePath+"?branch="+this.content.projectInfo.branchId+"&t="+Date.now()),this.content.ui.$playGame.attr("target",
"_blank"),a!=this.port&&(this.port=a,console.warn("Game port changed: "+a),this.loadMap())):(console.error("Game server port not set!!!"),this.basePath=b.protocol+"//"+b.hostname+":"+b.port+"/"+this.content.activeProject+"/")},init:function(){this.mapFrame=this.content.ui.$mapFrame[0];this.map=this.mapFrame.contentWindow;this.content.ui.$mapFrame.show();this.setPort(this.content.mapPort)},defaultLevelId:0,setDefaultLevel:function(){var a=this.content.buffer.Plugin;if(a)for(var b in a){var c=a[b];
if("Engine"===c.name){this.defaultLevelId=c.defaultLevel;break}}},start:function(){this._setNewItemTitle();this.setupMap();this.startMap()},startMap:function(){this.map||this.loadMap()},deactivate:function(){$("body").removeClass("_map");var a=this.content.ui;a.$helperButtons.find("#selectMap").remove();a.initSortable();this.butt.remove();this.butt=null;this.scrollbar&&(this.scrollbar.destroy(!0),this.scrollbar=null)},getItems:function(a){var b=this;this.mapReady=!1;this._getItems(function(c){b.createList(c);
a&&a()})},changeMap:function(a){if(a){if(this.activeMapId==a.id){this.map.SendSignal("Scene.IN",this.map.Scene.Event.LOAD_LEVEL_ID,a.id);return}this.activeMapId=a.id}else this.activeMapId=this.defaultLevelId;try{this.map.SendSignal("Scene.IN",this.map.Scene.Event.LOAD_LEVEL_ID,this.activeMapId)}catch(b){}},selectTool:function(a){if(!this.map||!this.map.SendSignal||!this.map.Editor)return 0;var a=parseInt(a),a=this.content.buffer.Entity[a],b=this.activeLayer;"Brush"==this.activeLayer&&(b="Terrain");
this.map.SendSignal("Editor",this.map.Editor.Event.USE_PLUGIN,b);this.map.SendSignal("Editor",this.map.Editor.Event.SET_MODE,this.map.Editor.Mode.ADD);this.map.SendSignal("Editor",this.map.Editor.Event.USE_ITEM_ID,a.id);return 1},setAction:function(a){if(!this.map||!this.map.SendSignal||!this.map.Editor)return 0;this.map.SendSignal("Editor",this.map.Editor.Event.USE_PLUGIN,this.activeLayer);switch(a){case 0:this.map.SendSignal("Editor",this.map.Editor.Event.SET_MODE,this.map.Editor.Mode.SELECT);break;
case 1:this.map.SendSignal("Editor",this.map.Editor.Event.SET_MODE,this.map.Editor.Mode.MOVE);break;case 2:this.map.SendSignal("Editor",this.map.Editor.Event.SET_MODE,this.map.Editor.Mode.ROTATE);break;case 3:this.map.SendSignal("Editor",this.map.Editor.Event.SET_MODE,this.map.Editor.Mode.REMOVE)}},saveItem:function(a){var b=this;a.id&&this.saveMapLevel(a);this.content.load.saveItem(a,function(c){b.content.activeGroup[b.name]=c[0].editor.group;b.content.buffer[b.name][c[0].id]=c[0];b.activeMapId=
c[0].id;null==a.id&&(b.createList(b.content.buffer[b.name]),b.loadMap())})},saveMapLevel:function(a){a.id&&(this.map.SendSignal("Terrain.IN",this.map.Terrain.Event.RESIZE,a),this.map.SendSignal("Scene.IN",this.map.Scene.Event.SAVE_LEVEL,null))},basePath:"",loadMap:function(a){var b=this;if(void 0!==a)this.map.location.href=a,this.mapReady=!1,setTimeout(function(){b.checkMapReady()},500);else if(this.content.mapPort)this.setPort(this.content.mapPort),a=this.basePath+"?branch="+this.content.projectInfo.branchId+
"&editor=1&t="+Date.now(),this.loadMap(a);else if((a=this.content.getEnginePlugin("Server"))&&!parseInt(a.useSocket))a=window.location,this.basePath=a.protocol+"//"+a.hostname+":"+a.port+"/"+this.content.projectInfo.project+"/",a=this.basePath+"?branch="+this.content.projectInfo.branchId+"&editor=1&t="+Date.now(),this.map.location.href=a,this.mapReady=!1,setTimeout(function(){b.checkMapReady()},500)},deInit:function(){this.$wrapper&&(this.$wrapper.remove(),this.span.remove(),this.span=this.$wrapper=
null);this.butt&&(this.butt.remove(),this.butt=null)},mapReady:!1,checkerTimeout:0,checkMapReady:function(){this.mapReady=!1;try{if("about:blank"==this.map.location.toString()){this.checkMapAgain();return}if(this.map.SubscribeChannel&&this.map.Scene&&this.map.Scene.Event&&this.map.Scene.plugin.currentScene.isLoaded&&!this.map.Scene.plugin.currentScene.isLoading&&this.map.Resource.plugin.isLoaded){this.onMapReady();return}}catch(a){}this.checkMapAgain()},checkMapAgain:function(){var a=this;this.checkerTimeout&&
clearTimeout(this.checkerTimeout);this.checkerTimeout=setTimeout(function(){a.checkMapReady()},100)},onMapReady:function(){this.mapReady=!0;this.switchMap(this.activeMapId);this.content.ui.$mapTools.find(".active").removeClass("active");this.setAction(0);this.switchLayer();this.map.gParams.editor=this.content},setupMap:function(){this.setMap();this.setUpToolSize();this.addIcons()},setMap:function(){var a=this,b=this.content.ui,a=this;this.butt||(this.butt=$(Templates.button({text:_("btn_reload_map"),
id:"test"})),$("#helperButtons").append(this.butt),this.butt.on("click",function(){a.loadMap()}));a.createTools();b.$mapTools.off("click").on("click",function(a){b.$mapTools.children("span").removeClass("active");$(a.target).addClass("active")});$("body").addClass("_map");this.$layerSwitcher||this.addLayerSwitcher();if(this.mapReady){this.prepareDD();var c=this.content.buffer.Map[this.activeMapId];this.loadDefaultSettings(c,this.createMeta(c))}else this.loadMap()},prepareDD:function(){var a=this,
b={};this.setDefaultLevel();var c=this.activeMapId||this.defaultLevelId||0,d;for(d in Lists[this.name])b[d]=Lists[this.name][d];d={map:{_type:"list",_use:b,_reverse:1,value:c,onchange:function(){a.activeMapId=this.value;a.switchMap(this.value)}}};b=this.content.ui.$helperButtons.find("#selectMap");0==b.length&&(b=$("<div id='selectMap'></div>"),this.content.ui.$helperButtons.append(b));b.empty();c=new Otito({map:c},d);c.append(b[0]);this.content.ui.improveOtito(c)},addLayerSwitcher:function(){this.$layerSwitcher=
this.content.ui.$mapTools.parent().append(Templates.layerTabs(["Entity"],this.activeLayer));var a=this;this.$layerSwitcher.click(function(b){var c=$(b.target).data("layer");c&&(a.activeLayer=c,$(this).find(".active").removeClass("active"),$(b.target).addClass("active"),a.addIcons(),a.switchLayer())})},switchLayer:function(){if(this.mapReady){var a=0,a="Entity"===this.activeLayer?this.map.Entity.Layer.ENTITY:this.map.Entity.Layer.TERRAIN;this.map.SendSignal("Editor",this.map.Editor.Event.SET_LAYER,
a);this.setAction(0)}},setUpToolSize:function(){this.content.ui.$iconContainer.find("div.containerElement").outerWidth();this.scrollbar||(this.scrollbar=new iScroll("iconWrapper",{vScrollbar:!1,vScroll:!1,checkDOMChanges:!0}))},addIcons:function(){if(!this.$wrapper){var a=this;this.$wrapper=$(Templates.Map.layer(_("Entities")));this.holder=this.$wrapper.find(".ml_item_wrap");this.$wrapper.click(function(a){var a=$(a.target),b=$(this).find(".ml_item_wrap");a.attr("down")?b.scrollTop(b.scrollTop()+
b.first().height()):a.attr("up")&&b.scrollTop(b.scrollTop()-b.first().height())});this.$wrapper.addClass("dockable");this.$wrapper.appendTo(document.body);this.$wrapper.draggable({appendTo:"body",helper:"clone",handle:".ml_title",iframeFix:!0,start:function(){$(this).hide();this.parentNode!=document.body&&(this.parentNode.removeChild(this),document.body.appendChild(this))},stop:function(a,b){$(this).show();$(this).offset(b.helper.offset())},snap:"body, #mainMenu, #mainLeft"});var b=document.createElement("div");
b.style.cssText="position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: 1";this.$wrapper.resizable({start:function(){document.body.appendChild(b)},stop:function(){document.body.removeChild(b)}});this.span=$(Templates.Map.span());this.span.appendTo(this.content.ui.$settingsBlock);this.span.droppable({tolerance:"pointer",drop:function(a,b){b.draggable.detach();b.draggable.appendTo($(this));b.draggable.css({top:0,left:0})},activeClass:"ui-state-hover",hoverClass:"ui-state-active",accept:".dockable"});
this.$wrapper.find(".ui-dialog-titlebar-close").click(function(){a.$wrapper.hide()})}this.createIcons()},createIcons:function(){var a=[],b=this.content.buffer.Entity,c;for(c in b)void 0===b[c].type||(b[c].type==Import[this.activeLayer].Type.BASIC||b[c].type==Import[this.activeLayer].Type.BASE)||a.push(b[c]);this.holder.empty();this.content.ui.setView(null,0,a,this,this.holder);var a=this.content.knownGroups[this.name],d=this,e=this.$wrapper.find(".ml_select")[0],a=new Otito(null,{groups:{_type:"list",
use:a,value:this.content.activeGroup[this.name],_reverse:!0,onchange:function(a){d.content.activeGroup[d.name]=a.object.groups;$(e).empty();d.createIcons()}}});$(e).empty();a.append(e);this.content.ui.improveOtito(a)},getPath:function(){return this.content.activeProject},newAsset:function(){this._newAsset()},resizeIframe:function(){},createTools:function(){var a=this,b=this.content.ui;b.$mapTools.empty();b.$mapTools.append('<div class="tools_tittle"><div></div></div>');$(Templates.tools({"class":"select active",
title:"Select"})).appendTo(b.$mapTools).on("click",function(){a.setAction(0)});$(Templates.tools({"class":"move",title:"Move"})).appendTo(b.$mapTools).on("click",function(){a.setAction(1)});$(Templates.tools({"class":"rotate",title:"Rotate"})).appendTo(b.$mapTools).on("click",function(){a.setAction(2)});$(Templates.tools({"class":"delete",title:"Delete"})).appendTo(b.$mapTools).on("click",function(){a.setAction(3)});b.$mapTools.draggable({handle:".tools_tittle",iframeFix:!0,containment:"parent",axis:"x"})},
switchMap:function(a){if(this.mapReady){0==a&&(this.setDefaultLevel(),a=this.defaultLevelId);this.content.buffer.Map[a]||(this.setDefaultLevel(),a=this.defaultLevelId);this.activeMapId=a;if(this.content.action==this.name){this.prepareDD();var b=this.content.buffer.Map[a];this.loadDefaultSettings(b,this.createMeta(b))}this.changeMap(this.content.buffer.Map[a])}},clickItem:function(a,b){b&&(this.content.ui.$mapTools.find(".active").removeClass("active"),this.selectTool($(b).attr("id").substring(4))||
$(b).removeClass("active"))},deleteItem:function(a){a.id==this.defaultLevelId?this.content.ui.showError(_("error_delete_default_level")):confirm("Are you sure?")&&(this.content.load.delItem(a),delete this.content.buffer[this.name][a.id],this.createList(),this.activeMapId=this.defaultLevelId,this.setMap())},reset:function(){this.activeMapId=0;this.activeLayer="Entity"},$layerSwitcher:null,activeMapId:0,activeLayer:"Entity"});
Templates.Map={layer:function(a){return'<div class="map_layers"><div class="ml_title"><span>'+a+'</span><a href="#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div><div class="ml_select"></div><div class="ml_items"><div class="ml_item_wrap"></div><div class="clear"></div><div class="ml_updown ml_up"><div  up="true"></div></div><div class="ml_updown ml_down"><div  down="true"></div></div></div></div>'},span:function(){return'<div class="map-span"></div>'}};
Mighty.namespace("plugins.project");Mighty.require("plugins.deploy.Deploy");
Mighty.extend("plugins._plugin._Plugin")(Mighty.plugins.Project=Mighty.plugins.project.Project=function(){this.core=1},{content:null,core:1,"extends":["_plugin"],requires:["deploy"],buttons:{noSaveAsNew:!0},register:function(){this.content.demoMode||this.content.plugins.FileMenu.registerMenu({projects:{title:"Projects",action:"Project",link:"projects",id:"Project"}},1)},start:function(){this.showProjects();this._setNewItemTitle()},newAsset:function(){delete this.buttons.noSave;delete this.inputs.name.readonly;
this.buttons.noDelete=!0;this._drawInputs(this._loadDefaultSettings({name:""},this.inputs));delete this.buttons.noDelete},deleteItem:function(a){var b=this;confirm("Are you really want to delete project "+a.name+"?")&&this.content.load.delProject(a.name,function(){b.content.fullReset()})},saveItem:function(a){var b=this;this.content.ui.startLoading();!a||""==a.name?this.content.ui.showError("project_bad_name"):this.content.load.newProject(a,function(){b.changeProject(a.name)})},showProjects:function(){var a=
this;this.content.load.projects(function(b){b.sort();a.content.ui.hideGroups();a.loadDefaultSettings(a.content.activeProject);a.content.ui.mainView(a.templates.projects(b,a.content.activeProject)).find(".icon").click(function(b){a.changeProject($(this).data("id"));b.preventDefault();a.content.ui.removeActive();$(this).addClass("active");return!1});a.content.ui.initControls();a.content.projects=b})},getItems:function(a){a&&a()},loadDefaultSettings:function(a){this.inputs.name.readonly="readonly";this.buttons.noSave=
!0;this._drawInputs(this._loadDefaultSettings({name:a},this.inputs))},changeProject:function(a){this.content.setActiveProject(a)},selectProjectByName:function(){},templates:{projects:function(a,b){var c="",d;for(d in a)c+=this.project({name:a[d],image:"css/icon-theme/img/system.png"},b);return c},project:function(a,b){var c="";"undefined"===typeof a.id&&(a.id=a.name);if(b&&(a.name==b||a.id==b))c="active";return'\t\t\t<div class="icon containerElement '+c+'" id="icon'+a.id+'" data-id="'+a.id+'" title="'+
a.name+'">\t\t\t\t <div class="image"><div class="system"></div></div>\t\t\t\t <div class="text">'+a.name+'</div>\t\t\t\t <div class="controls" data-element="project">\t\t\t\t\t<div class="project" data-action="project">\t\t\t\t\t\t<a href="javascript:;" target="_newtab"></a>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t</div>\t \t\t'},projectItem:function(a){return'\t\t\t\t<div><span data-action="project" data-id="'+a+'" id="selectProject">'+a+"</span></div>\t\t\t"}},inputs:{id:{_type:"hidden",value:1},name:{_type:"string",
value:"",placeholder:"Project title"},editor:{_type:"hidden"}}});Mighty.namespace("plugins.sideMenu");
Mighty(Mighty.plugins.SideMenu=Mighty.plugins.sideMenu.SideMenu=function(){this.core=1},{menus:[],menu:null,scroller:null,wrapper:"mainMenuWrapper",register:function(){this.menu=this.content.ui.$mainMenu},init:function(a){this._init(a)},deinit:function(){},templates:{menu:function(a){var b="";"undefined"!==typeof a._clickID&&(b='data-clickID="'+a._clickID+'"');return'<a href="#'+a.link+'" id="'+(a.id?a.id:a.action)+'" '+b+' title="'+_(a.title)+'" data-action="'+a.action+'" tip="'+a.title+'"><span>'+
_(a.title)+"</span></a>"}},menuItemClick:function(a,b){b.preventDefault();var c=$(a).data("clickid");if(void 0===c)return!1;this.content.ui.$search.val("");c=this.callbacks[c](b);b.cancelBubble=!0;return c},buildMenu:function(){this._buildMenu();this.scroll=this.content.ui.attachScroller(this.content.ui.$mainMenu[0],!0)}}).extend("plugins._menu._Menu");Mighty.namespace("plugins.sound");
Mighty(Mighty.plugins.Sound=Mighty.plugins.sound.Sound=function(){this.core=1;this.defaultItem={type:Import.Resource.Type.SOUND}},{core:1,enginePlugin:"Resource",register:function(){this.content.plugins.SideMenu.registerMenu({sounds:{title:"Sounds",action:"Sound"}},1)},newAsset:function(){this._newAsset(Tools.clone(this.defaultItem))}}).extend("plugins._plugin._Plugin");Mighty.namespace("plugins.fileMenu");
Mighty(Mighty.plugins.FileMenu=Mighty.plugins.fileMenu.FileMenu=function(){this.core=1},{core:1,"extends":["_menu"],menus:[],register:function(){this.menu=this.content.ui.$fileMenu},init:function(){this._init()},setActive:function(a){this.setActiveIcon(a);return!0}}).extend("plugins._menu._Menu");
Mighty(Mighty.plugins.DeployMenu=function(){this.core=1},{core:1,"extends":["_menu"],menus:[],register:function(){this.menu=this.content.ui.$deployMenu;this.content.ui.$deployMenu.addClass("right")},init:function(){this._init()},setActive:function(a){this.setActiveIcon(a);return!0}}).extend("plugins._menu._Menu");Mighty.requireFile("js/plugins/sourceEditor/"+cfg.sourceEditorBackend+".js",null,1);Mighty.namespace("plugins.sourceEditor");
Mighty(Mighty.plugins.SourceEditor=Mighty.plugins.sourceEditor.SourceEditor=function(){this.sessions={};this.activeFile="";this.activeElement=null;this.noNewAsset=this.core=1;this.data=null;this.forceReload=!1;this.editorElement=document.createElement("div");this.editorElement.style.cssText="position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 0;";this.editor=new Mighty.plugins.SourceEditor[cfg.sourceEditorBackend](this);this.saveCBs=[];this.loadIndex=!0},{addSaveCb:function(a){this.saveCBs.push(a)},
onSave:function(a){if(this.activeElement.origText&&!0==this.activeElement.isChanged){this.activeElement.innerHTML=this.activeElement.origText;this.activeElement.isChanged=!1;this.items.map[this.activeFile]=a;this.saveFile(this.activeFile);for(a=0;a<this.saveCBs.length;a++)this.saveCBs.pop()(this.activeElement.origText)}},clearCBs:function(){this.saveCBs.length=0},register:function(){this.menuItem=this.content.plugins.SideMenu.registerMenu({SourceEditor:{title:"SourceEditor",action:"SourceEditor"}},
0);var a=this;this.content.load.a_sourceChanged=function(){a.getItems(function(){a.content.action==a.name&&a.start()})}},start:function(){this.content.ui.$newAssetButton.hide();this.content.ui.$iconContainer.empty();this.content.ui.$iconContainer[0].appendChild(this.editorElement);this.content.ui.hideGroups();this.genFileList();var a=this.content.ui.$settings;a.empty();this.otito.append(a[0]);this.editor.focus();this.editor.refresh();if(this.butt)$("#helperButtons").append(this.butt),$("#helperButtons").append(this.hotkeysMenu);
else{var b=this;this.butt=$(Templates.button({text:_("btn_settings"),id:"sourceEditorSettingsBtn"}));$("#helperButtons").append(this.butt);this.butt.on("click",function(){b.showSettings()});this.hotkeysMenu=$(Templates.button({text:_("btn_hotkeys"),id:"sourceEditorHotkeysBtn"}));$("#helperButtons").append(this.hotkeysMenu);this.hotkeysMenu.on("click",function(){b.showHotkeys()})}this.loadIndex&&(a=Object.keys(this.items.map),this.selectFile(a[a.length-1]),this.loadIndex=!1)},settingHolder:null,showSettings:function(){if(!this.settingHolder){var a=
new Otito(null,Tools.clone(this.editor.cfg)),b=this;this.settingHolder=$("<div></div>");this.settingHolder.dialog({title:_("sourceEditor_settings_title"),close:function(){$(this).dialog("destroy");b.settingHolder=null},buttons:[{text:_("btn_apply"),click:function(){Storage.set("sourceEditor",a.object);b.editor.updateOptions(a.object);b.editor.cfg=a.object}},{text:_("btn_close"),click:function(){$(this).dialog("close")}},{text:_("btn_reset"),click:function(){$(this).dialog("close");b.editor.cfg=Tools.clone(b.editor.defaultCfg);
b.editor.updateOptions(b.editor.cfg);b.showSettings()}}],width:655,height:500,resizable:!1});a.append(this.settingHolder[0]);this.content.ui.improveOtito(a)}},hotKeysHolder:null,showHotkeys:function(){if(!this.hotKeysHolder){var a=new Otito(null,{save:{_type:"text",readonly:"readonly",value:"ctrl - s"},copyLine:{_type:"text",readonly:"readonly",value:"ctrl - alt - down"},deleteLine:{_type:"text",readonly:"readonly",value:"ctrl - d"},moveLineUp:{_type:"text",readonly:"readonly",value:"alt - up"},moveLineDown:{_type:"text",
readonly:"readonly",value:"alt - down"},toggleComment:{_type:"text",readonly:"readonly",value:"ctrl - /"},autocomplete:{_type:"text",readonly:"readonly",value:"ctrl - space"}}),b=this;this.hotKeysHolder=$("<div></div>");this.hotKeysHolder.dialog({title:_("sourceEditor_hotkeys_title"),close:function(){$(this).dialog("destroy");b.hotKeysHolder=null},width:366,height:266,resizable:!1});a.append(this.hotKeysHolder[0]);this.content.ui.improveOtito(a)}},clickItem:function(){},getItems:function(a){var b=
this;this.content.load.action("getSourceTree",null,function(c){var d="",e={map:{},all:{},elements:{}},f;for(f in c.map)d=f.split("\\").join("/"),e.map[d]=c.map[f];for(f in c.all)d=f.split("\\").join("/"),e.all[d]=c.all[f];if(!b.items||b.forceReload)b.forceReload=!1,b.items=e,b.otito=new Otito(null,b.genFileList());else for(f in e.map)if(b.items.map[f]!==e.map[f]){b.items=e;b.otito=new Otito(null,b.genFileList());a();return}a()})},click:function(){},deactivate:function(){this.otito.remove();this.content.ui.$iconContainer[0].removeChild(this.editorElement);
this.butt.detach();this.hotkeysMenu.detach();this.settingHolder&&this.settingHolder.dialog("close");this.hotKeysHolder&&this.hotKeysHolder.dialog("close")},activate:function(){console.log("activet")},saveFile:function(a,b,c,d){var e=this.content.ui.showNotify(_("Saving..."),a.split("/").pop(),9999),f=Date.now();this.content.load.action("saveFile",{fileName:a,data:this.items.map[a]||c,isFolder:b},function(){e.title(_("Saved!"));var a=2E3-(Date.now()-f);e.hide(a);d&&d()})},showNewFileDialog:function(a){var b=
new Otito(null,{name:{_type:"text",onchange:function(){this.otito.childs.isFolder.input.setValue(1==this.value.split(".").length)}},isFolder:!1}),c=this,d=$("<div></div>");d.dialog({title:_("Create_new_file"),close:function(){$(this).dialog("destroy")},buttons:[{text:_("btn_save"),click:function(){c.saveFile(a+"/"+b.object.name,b.object.isFolder);c.forceReload=!0;$(this).dialog("close")}},{text:_("btn_cancel"),click:function(){$(this).dialog("close")}}],width:520,height:240,resizable:!1});b.append(d[0]);
this.content.ui.improveOtito(b);b.childs.name.input.focus()},genFileList:function(){var a={__className:"active"},b=this,c=null,d=null,e=[],f;for(f in this.items.map)c=f.split("/"),e.push(c);for(f in this.items.all)c=f.split("/"),e.push(c);e.sort(function(a,b){var c=b.length-a.length;0==c&&(c=b.join()<a.join());return c});for(f=0;f<e.length;f++)for(var c=e[f],d=a,g=4;g<c.length;g++){if(void 0==d[c[g]]){var i=this.getLinkLoc(c);if(g==c.length-1&&void 0!=this.items.map[i])d[c[g]]={_type:"link",value:c[g],
oncreate:function(a){return function(c){b.items.elements[a]=c}}(i),onclick:function(){b.selectFile(this.dataFile)},_headless:!0,dataFile:i};else{if(g==c.length-1&&!this.items.all[i].isDir)continue;for(var i=[],j=0;j<g+1;j++)i.push(c[j]);d[c[g]]={"+":{_type:"link",_headless:!0,className:"buttonSmall",dataFolder:i.join("/"),onclick:function(){b.showNewFileDialog(this.dataFolder)}}}}}d=d[c[g]]}return a},selectFile:function(a){console.log(a);this.activeElement&&(this.activeElement.style.fontWeight=null);
this.activeElement=this.items.elements[a];this.activeElement.style.fontWeight="bold";this.activeFile=a;this.editor.loadSource(a);this.clearCBs()},getLinkLoc:function(a){return a.join("/")},onSourceChanged:function(a,b){this.items.map[this.activeFile]!=b?this.activeElement.isChanged||(this.activeElement.origText=this.activeElement.innerHTML,this.activeElement.innerHTML+="*",this.activeElement.isChanged=!0):this.activeElement.origText&&!0==this.activeElement.isChanged&&(this.activeElement.innerHTML=
this.activeElement.origText,this.activeElement.isChanged=!1)}}).extend("plugins._plugin._Plugin");Mighty.namespace("plugins.fastUpload");Mighty.require("plugins.texture.Texture").require("plugins.sound.Sound").require("plugins.brush.Brush").require("plugins.entity.Entity");
Mighty.extend("plugins._plugin._Plugin")(Mighty.plugins.FastUpload=Mighty.plugins.fastUpload.FastUpload=function(a){this.element=document.createElement("div");this.element.className="fastUpload";Tools.ui.addCss("js/plugins/fastUpload/fastUpload.css");var b=this;a.on(function(a){b["set"+a]?(b.element.parentNode||b.content.ui.$iconWrapper[0].appendChild(b.element),b.action=a,b["set"+a]()):b.element.parentNode&&b.element.parentNode.removeChild(b.element)})},{deInit:function(){this.element.parentNode&&
this.element.parentNode.removeChild(this.element)},register:function(){this.createUploader()},setTexture:function(){this.uploader._options.allowedExtensions=this.content.cfg.imageExtensions},setSound:function(){this.uploader._options.allowedExtensions=this.content.cfg.soundExtensions},setBrush:function(){this.uploader._options.allowedExtensions=this.content.cfg.imageExtensions},setEntity:function(){this.uploader._options.allowedExtensions=this.content.cfg.imageExtensions},uploadCompleted:function(a){var b=
a.split(".");b.pop();b=b.join(".");"Texture"==this.action||"Brush"==this.action||"Entity"==this.action?this.createTexture(b,a):"Sound"==this.action&&this.createSound(b,a)},createTexture:function(a,b){var c=this.content.plugins.Texture,d=c.mkItem();d.object.name=a;d.object.image=b;d.object.editor.group=this.content.activeGroup[this.content.action];var e=this;c.saveItem(d.object,function(a){"Brush"==e.action||"Entity"==e.action?e.createBrush(a[0]):e.refreshView()},"Texture",1)},createBrush:function(a){var b=
this.content.plugins.Brush.mkItem();b.object.texture=a.id;b.object.name=a.name;b.object.editor.group=this.content.activeGroup[this.content.action];var c=this;this.content.load.saveItem(b.object,function(a){"Entity"==c.action?c.createEntity(a[0]):c.refreshView()},"Brush",1)},createEntity:function(a){var b=this.content.plugins.Entity.mkItem();b.object.brush=a.id;b.object.name=a.name;b.object.editor.group=this.content.activeGroup[this.content.action];var c=this;this.content.load.saveItem(b.object,function(){c.refreshView()},
"Entity",1)},createSound:function(a,b){var c=this.content.plugins.Sound.mkItem();c.object.name=a;c.object.sound=b;c.object.editor.group=this.content.activeGroup[this.content.action];var d=this;this.content.load.saveItem(c.object,function(){d.refreshView()},"Sound",1)},createUploader:function(){var a=this;this.uploader=new qq.FileUploader({element:this.element,allowedExtensions:["png"],action:cfg.uploadFile,params:{project:a.content.activeProject,action:"itemFile"},buttonText:"",onComplete:function(b,
c,d){d&&a.uploadCompleted(d.file)}});$(this.element).find(".qq-upload-drop-area").on("click",function(){$(this).hide()})},refreshView:function(){var a=this;window.setTimeout(function(){a.content.ui.refreshView()},100)}});
lang={"Branch Name":"Enter branch name",action:"Current action",branch:"Active branch",btn_Documentation:"Docs and Tutorials",btn_Examples:"Examples",btn_close:"Close",btn_copy:"Copy",btn_delete:"Delete","btn_new Branch":"New Branch","btn_new Brush":"New Brush","btn_new Component":"New Component","btn_new Entity":"New Entity","btn_new Map":"New Map","btn_new Plugin":"New Plugin","btn_new Sound":"New Sound","btn_new Texture":"New Texture","btn_new i18n":"New String",btn_reload_map:"Reload map",btn_save:"Save",
label_error:"oops.. Error!",label_welcome_title:"Welcome!",project:"Project","btn_import Project":"Import project","btn_create Project":"Create New project",btn_advance:"Advance","btn_new Project":"New Project",label_projects:"Recent projects",title_welcome:"Welcome to MightyEngine",disabled_in_demo:"Sorry, this feature is disabled in demo",title_welcome_demo:"Welcome to MightyEngine demo",label_your_test_project:"start demo",btn_advance_Texture:"Convert to Brush",btn_advance_Brush:"Convert to Entity",
btn_create:"Create",title_newProject:"New project",label_project_name:"Project name:",label_creating_new_project:"Creating project.. please wait",label_startting_up:"Warming up.. please wait","Multi Import":"Multi Import",label_texture_template:"Texture template:",label_brush_template:"Brush template:",label_group:"Group:",label_leave_blank_to_skip:"* Leave blank to skip",btn_click_to_upload:"Click to upload",btn_done:"Done","label_Deploy report":"Deploy report",label_layers:"Layers:","btn_new Deploy":"New Deploy",
"Add more":"Add New","Deploy in progress":"Deploy in progress","Deploy: ":"Deploy: ","Deploy completed":"Deploy completed",Sounds:"Sounds",btn_cancel:"Cancel","executes program in release {path}, after deploy finished.":"Executes program in the release {path}, after deploy finished.","release path":"Release path",Textures:"Textures",SourceEditor:"Source Editor",Brushes:"Brushes",Component:"Component",Entity:"Entity",Addons:"Addons",Plugins:"Plugins",Localization:"Localization",Map:"Map",sourceEditor_settings_title:"Settings",
btn_settings:"Settings",btn_apply:"Apply",btn_reset:"Reset",sourceEditor_hotkeys_title:"Hotkeys",btn_hotkeys:"Hotkeys"};"undefined"!=typeof window&&document.addEventListener("touchmove",function(a){a.preventDefault()});Mighty=global.Mighty;
Mighty.requireFile("js/jquery/jquery.latest.min.js",function(){Mighty.requireFile("js/jquery/jquery-ui-1.10.3.custom.js",function(){Mighty.requireFile("js/jquery/jquery.addons.js",null,1);Mighty.requireFile("js/jquery/jquery.colorpicker.js",null,1);Mighty.requireFile("js/jquery/jquery.dataTables.min.js",null,1)},1)},1).requireFile("js/tools/tools.ui.js");Mighty.namespace("ui");
Mighty(Mighty.ui.UI=function(){this.groupsInitialized=0;this.deactivateFn=this.$reloadImport=this.$info=this.$groupAndSearch=this.$groups=this.$newAssetButton=this.$mapFrame=this.$mapControls=this.$map=this.$mapTools=this.$topBar=this.$settingsBlock=this.$settings=this.$mainView=this.$deploy=this.$iconContainer=this.$subMenu=this.$mainMenu=this.$toSave=this.$searchBlock=this.$search=this.groupScroll=this.map=null;this.zoom=1;this.modalDialog=this.errorContent=null;this.lastView=[];this.scrollBars=
[];this.views={}},{init:function(a){var b=this;this.content=a;for(var c in cfg.ui)this[c]=$(cfg.ui[c]);this.startLoading(_("label_startting_up"));this.setResizable();this.bindEvents();this.setGroupActions();this.initSortable();document.body.onclick=function(a){b.handleGlobalClick(a)}},errorCb:Mighty.emptyFn,showError:function(a,b,c){"function"==typeof b&&(c=b,b="");void 0==b&&(b="");var d=this;if(c){var e=this.errorCb;this.errorCb=function(){e();c()}}var f="";if(Array.isArray(a))for(b=0;b<a.length;b++)f+=
Templates.errorHolder(a[b].error,a[b].file);else f=Templates.errorHolder(_(a),b);this.errorContent||(this.errorContent=$('<div class="error"></div>'));this.errorContent.prepend('<div class="error-inner"><span class="error-time">'+(new Date).toString()+"</span>"+f+"</div>");this.errorContent.dialog({title:_("label_error"),close:function(){d.stopLoading();d.errorContent.empty();$(this).dialog("destroy");d.errorCb();d.errorCb=function(){}},resizable:!0,width:710,modal:!0,height:350,buttons:[{text:_("btn_close"),
click:function(){$(this).dialog("close")}}],dialogClass:"ui-error-dialog"});this.stopLoading()},showStartingScreen:function(a,b){a.sort();var c=this,d=$(Templates.startingScreen(a,b));d.dialog({title:_("title_welcome"),close:function(){c.closeModal();!b||"null"==b?(c.content.action="Project",c.showStartingScreen(a,b)):c.content.setActiveProject(b);$(this).dialog("destroy")},width:790,height:510,resizable:!1});this.attachScroller(d.find(".allProjects")[0]);this.createSimpleUpload(d.find(".upload")[0],
function(){d.dialog("destroy");c.closeModal()});d.find(".projectItem").click(function(){var a=$(this).text();c.content.setActiveProject(a);d.dialog("destroy");c.closeModal()});d.find(".mainLinks a").click(function(e){var f=$(this).data("action");if(f&&c[f])c[f](function(){d.dialog("destroy");c.closeModal()},a,b);else"javascript:;"!=$(this).attr("href")&&(c.openPopup($(this).attr("href")),e.preventDefault())});this.stopLoading();this.showModal()},showModal:function(){this.modalDialog||(this.modalDialog=
$('<div class="ui-widget-overlay" style="z-index: 1000;"></div>'));$(document.body).append(this.modalDialog)},closeModal:function(){this.modalDialog&&this.modalDialog.detach()},newProject:function(a,b,c){var d=$(Templates.newProject()),e=this,f=function(){var f=d.find("input").val();f&&(e.content.newProject(f,function(){e.showStartingScreen(b,c)}),a());d.dialog("close")};d.dialog({title:_("title_newProject"),close:function(){$(this).dialog("destroy")},buttons:[{text:_("btn_close"),click:function(){$(this).dialog("close")}},
{text:_("btn_create"),click:function(){f()}}],width:600,modal:!0,height:250});d.find("input").on("keyup",function(a){13==a.which&&f()})},showDemoScreen:function(a,b){var c=this,d=$(Templates.demoScreen(a,b));d.dialog({title:_("title_welcome_demo"),close:function(){c.content.setActiveProject(b);$(this).dialog("destroy")},width:880,modal:!0,height:400,buttons:[{text:_("btn_close"),click:function(){$(this).dialog("close")}}],resizable:!1});d.find(".mainLinks a").click(function(a){c.openPopup($(this).attr("href"));
a.preventDefault()});d.find(".projectItem, .title").click(function(){d.dialog("close")});this.stopLoading()},openPopup:function(a,b){window.open(a,b||"_blank")},setZoom:function(){},hideGroups:function(){this.$mainView.addClass("noGroups");this.$groupAndSearch.css({display:"none"})},showGroups:function(){this.$mainView.removeClass("noGroups");this.$groupAndSearch.css({display:"block"})},startLoading:function(a){this.setPath("Loading "+this.content.action+"...");$("#loading .text").html(a);$("#loading").show()},
stopLoading:function(){this.setInfo();this.content.load.loadings=0;$("#loading").hide()},loadingText:function(a){$("#loading .text").html("Loading - "+a)},notifyArray:[],showNotify:function(a,b,c){var c=c||5E3,d=$(Templates.notify(a,b)),e=function(){d.removeClass("active");window.setTimeout(function(){f.removeNotify(d)},5E3)},f=this;d.appendTo("#notifyHolder");this.notifyArray.push(d);window.setTimeout(function(){d.addClass("active")},0);window.setTimeout(e,c);d.on("click",e);d.hide=function(a){window.setTimeout(e,
a||0)};d.title=function(a){d.find(".title").html(a)};return d},removeNotify:function(a){for(var b=0;b<this.notifyArray.length;b++)if(this.notifyArray[b]==a){this.notifyArray.splice(b,1);a.remove();break}},removeSettings:function(){this.$toSave.empty()},setInfo:function(){var a=Templates.info({project:this.content.activeProject,branch:this.getBranchName(this.content.projectInfo.branchId),action:this.content.action});this.$info.html(a);this.content.plugins._Menu&&this.content.plugins._Menu._setActive($("#"+
this.content.action)[0],1)},setPath:function(a){if(this.content.activeProject){var b='<span class="project">'+this.content.activeProject+"("+this.getBranchName(this.content.projectInfo.branchId)+"):</span>";if("string"===typeof a)b="<span>"+a+"</span>";else for(var c in this.content.fullPath)b+=" /"+Templates.set(this.content.fullPath[c],"activeItem");this.$info.html(b)}},handleGlobalClick:function(a){var a=$(a.target),b=a.data("cbid");if(void 0==b||Templates.callBacks[b]())$(".popup").addClass("hidden"),
a.hasClass("folder")&&a.toggleClass("active"),a.hasClass("head")&&a.parent().toggleClass("active")},removeActive:function(){this.$iconContainer.find(".active").removeClass("active");this.$groups.children().remove()},mainView:function(a){return this.$iconContainer.html(a)},resize:Mighty.emptyFn,setResizable:function(){var a=this;window.onresize=function(){a.refreshScrollbars()}},fixZoomBySize:function(){if(600>window.innerHeight){var a=window.innerHeight/600;if(this.zoom!==a)return this.setZoom(a),
1}return 600<window.innerHeight&&1!==this.zoom?(this.setZoom(1),1):0},refreshView:function(){this.setView.apply(this,this.lastView)},changeView:function(){var a=this.content.plugins[this.content.action];this.views[this.content.action]||(this.views[this.content.action]=a.template);this.views[this.content.action]="iconView"==this.views[this.content.action]?"tableView":"iconView";this.refreshView()},setView:function(a,b,c,d,e){var f=this.content.action,d=d||this.content.plugins[f];c?j=c:(this.content.sortData("name",
f),j=this.content.sortedData);var g=this.content.activeGroup[this.content.action];g||(g=j[0]?j[0].editor.group:cfg.defaultGroup);this.views[this.content.action]||(this.views[this.content.action]=d.template);var i=this.views[this.content.action];this.lastView=arguments;var j,h=this,m=!1,k=e?$(e):this.$iconContainer;k.children().remove();var n=null;"tableView"==i&&(n=$(Templates.emptyTable()),n.append($(Templates.tableHead(j,g))),k.append(n),k=n);b&&(this.groupsInitialized=0);this.showGroups();this.deactivateFn&&
(this.deactivateFn(),this.deactivateFn=null);if(0===this.groupsInitialized){this.$groups.empty().append(Templates.set({},"groups"));var t=$("#groupContent");this.savedGroups={}}var q=function(){var b=0;j.length||h.hideGroups();for(var c=0;c<j.length;c++){if(""!=h.$search.val()){var e;try{e=RegExp(h.$search.val(),"i");if(!d.search||!d.search(e,j[c]))continue;m=!0}catch(f){console.error("UI::SetView::CreateIcons::Search -> invalid regexp",f)}}if("undefined"==typeof j[c].editor.group||""===j[c].editor.group)j[c].editor.group=
cfg.defaultGroup;var l=j[c].editor.group,n=j[c].editor.group;!0===m&&(l="Search",n="Search results");0===h.groupsInitialized&&h.addGroupItem(l,n);if(m||j[c].editor.group==g)b++,l=j[c],n="",l.file?n=l.file.split("/").pop():l.sound&&(n=l.sound),l={name:l.name||l.key,id:l.id,file:h.content.activeProjectPath+"/"+cfg.uploadPath+n,image:h.getImage(l),active:a==l.id?!0:!1,color:l.color||l.editor.color,object:l,branch:h.getBranchName(l.editor.branch)},l=$(Templates[i](l,g)),l.click(function(a){if(!$(a.target).parent().hasClass("controls")){var b=
h.content.getItemFromElement(this);if(!a.ctrlKey||!h.content.selectedItems.length)k.find(".active").removeClass("active"),h.content.selectedItems.splice(0,h.content.selectedItems.length),h.content.selectedItems.push(b),d.clickItem(b,this),$(this).addClass("active");else{for(a=0;a<h.content.selectedItems.length;a++)if(h.content.selectedItems[a]===b){h.content.selectedItems.splice(a,1);$(this).removeClass("active");return}$(this).addClass("active");h.content.selectedItems.push(b);h.$toSave.html("multiple files selected");
b={_nosave:!0,_nosaveas:!0,_noadvance:!0,_delete:function(){if(confirm("Are you sure?"))for(var a=0;a<h.content.selectedItems.length;a++)d.deleteItem(h.content.selectedItems[a],null,!0)}};b.advanceTitle="btn_advance_"+h.content.action;h.$toSave.append(Templates.saveBlock(b))}}}),k.append(l),h.initControls(l)}return b};this.activeGroupElement=null;if(!q()&&0===this.groupsInitialized){t.empty();var f=null,p;for(p in h.savedGroups)void 0==f&&(f=p),h.savedGroups[p]=null;this.content.activeGroup[this.content.action]=
f;q()}0==this.groupsInitialized&&(this.groupsInitialized=1,this.groupScroll=new iScroll("groupList",{hScrollbar:!1,vScrollbar:!1,vScroll:!1}),$("#groupList .groupIcon").droppable({tolerance:"pointer",drop:function(a,b){var c=$(b.draggable).data("id");if(h.content.buffer[h.content.action]){var d=h.content.buffer[h.content.action][c];if(d){var e=$(this).data("group");e&&(d.editor.group=e,$(b.draggable).remove(),h.content.load.saveItem(d,null,null,1),h.content.buffer[h.content.action][c]=d,$(this).removeClass("accept"))}}},
over:function(){$(this).addClass("accept")},out:function(){$(this).removeClass("accept")},addClasses:0}),"Map"===h.content.action&&h.content.plugins.Map.setUpToolSize());this.resize();this.activeGroupElement&&this.groupScroll.scrollToElement(this.activeGroupElement[0]);"tableView"==i&&n.dataTable({bJQueryUI:!0,bPaginate:!1,bLengthChange:!1,bFilter:!1,bSort:!0,bInfo:!1,bSearch:!1})},activeGroupElement:null,addGroupItem:function(a,b){if(void 0==this.savedGroups[a]){var c="";this.content.activeGroup[this.content.action]||
(this.content.activeGroup[this.content.action]=b);this.content.knownGroups[this.content.action]||(this.content.knownGroups[this.content.action]={});this.content.knownGroups[this.content.action][a]=b;a==this.content.activeGroup[this.content.action]&&(c="active");var d=$(Templates.set({title:b,group:a,"class":c},"groupIcon"));$("#groupContent").append(d);"active"==c&&(this.activeGroupElement=d);this.savedGroups[a]=1}},getBranchName:function(a){return!Lists||!Lists.Branch?a:this.content.projectInfo.branchId==
a?'<span style="color: green">'+Lists.Branch[a]+"</span>":'<span style="color: red">'+Lists.Branch[a]+"</span>"},setGroupActions:function(){var a=this;this.$groups.click(function(b){var c=$(this).find(".active:first");if(!a.groupScroll||!a.groupScroll.activeElement)a.groupScroll.activeElement=c;var b=$(b.target),d=b.data("group"),e=b.text();d?(a.content.activeGroup[a.content.action]=e,a.setView.apply(a,a.lastView),c.removeClass("active"),b.addClass("active"),a.groupScroll.activeElement=b,"Map"===
a.content.action&&a.content.plugins.Map.setUpToolSize()):(c=b[0].className,"moveRight"==c?a.groupScroll.activeElement.next().length&&(a.groupScroll.activeElement=a.groupScroll.activeElement.next(),a.groupScroll.scrollToElement(a.groupScroll.activeElement[0]),a.groupScroll.activeElement.click()):"moveLeft"==c&&a.groupScroll.activeElement.prev().length&&(a.groupScroll.activeElement=a.groupScroll.activeElement.prev(),a.groupScroll.scrollToElement(a.groupScroll.activeElement[0]),a.groupScroll.activeElement.click()))})},
getTextureImage:function(a){var b="";if(!a.image||""==a.image)a.image=a.img;b=a.image;a=b.split("/").pop();return this.content.activeProjectPath+"/"+cfg.uploadPath+a},getImage:function(a){if(void 0===a)return null;if(void 0!==a.image||a.img)return this.getTextureImage(a);if(void 0===this.content.buffer.Texture)return null;var b;return(b=this.content.buffer.Texture[a.texture])?this.getTextureImage(b):a.brush?this.getImage(this.content.buffer.Brush[a.brush]):null},initSortable:function(a){var b=this,
a=a||this.$iconContainer;a.sortable({update:function(){b.$iconContainer.find("div.containerElement").each(function(a){if("undefined"===typeof b.content.buffer[b.content.action][$(this).attr("id").substring(4)])return!0;b.content.buffer[b.content.action][$(this).attr("id").substring(4)].editor.sort=a});b.content.sortData();b.content.load.saveOrder()},scroll:!0,appendTo:"body",helper:"clone",items:".icon"});this.$iconContainer.append('<div class="clear"></div>')},deInitSortable:function(){this.$iconContainer.sortable("destroy")},
bindEvents:function(){this.setSearch();var a=this;$(".logo").off("click").on("click",function(){a.content.starting()});this.$changeView.off("click").on("click",function(){a.changeView()});this.$newAssetButton=$("#newAsset");$("#newAsset, #newMap").off("click").on("click",function(){a.content.newAsset()});this.$export.off("click").on("click",function(b){a.content.load.exportProject();b.preventDefault();return!1});this.$logout.off("click").on("click",this.logOut);this.$reloadImport.off("click").on("click",
function(b){var c=a.content.action;a.content.fullReset(function(){a.content.setAction(c)});b.preventDefault();return!1});this.createButtons()},deployReport:function(a){var b=$(Templates.deploy(a));b.dialog({title:_("label_Deploy report"),buttons:{done:{title:_("btn_done"),text:_("btn_done"),click:function(){$(this).dialog("close")}}},width:750,height:500,position:{top:30},close:function(){$(this).dialog("destroy");b.remove()}});b.find(".dialogContent").tabs()},logOut:function(a){$.post("./","action=logout",
function(){window.open("./","_top")});a&&a.preventDefault();return!1},setSearch:function(){var a=this;this.$search.bind("keyup blur",function(){a.groupsInitialized=0;a.setView.apply(a,a.lastView)}).bind("focus",function(){$(this).val("")})},selectItem:function(a){a=a||this.content.activeItem;this.$iconContainer.find("div.active").removeClass("active");$("#icon"+a).addClass("active")},drawSettings:function(a,b){this.$settings.html(a);this.createWidgets(this.$settings,b)},createWidgets:function(a){"object"!==
typeof a&&(a=$(a));this.createDynamicTemplate(a)},createFieldset:function(){$("fieldset.object .legend",this.$settings).off("click").on("click",function(){$(this).parent().toggleClass("closed")});$("fieldset.folder .legend",this.$settings).off("click").on("click",function(){$(this).parent().toggleClass("closed")})},createSaveDelete:function(a,b){var a=a||this.$settings,c=this;a.find(".saveDeleteButtons").click(function(a){var e=$(a.target).parent(),a=e.data("action"),e=e.data("cbid");if("undefined"!=
typeof e)Templates.callBacks[e](c.content.collectSettings(c.$settings));else switch(a){case "save":c.content.saveSettings(c.$settings);break;case "savenew":c.content.saveSettings(c.$settings,!0);break;case "delete":confirm("Are you sure?")&&(c.content.delete(b),c.$settings.empty());break;case "advance":c.content.plugins[c.content.action].advance(c.$settings)}})},createCombobox:function(a){$(".list",a).combobox({cb:function(a){return Templates.callBacks[a]},filter:function(a,c,d){if("function"===typeof Templates.filters[a])return Templates.filters[a](c,
d)}});$(".comboboxToggle",a).click(function(){$(this).parent().find(".list").toggle()})},createSlider:function(a){$(".slider",a).each(function(){var a=$(this).parent().find("div.sliderTool");0==a.length&&(a=$('<div class="sliderTool"></div>'),$(this).addClass("sliderInfo"),$(this).parent().append(a));var c=$(this);c.parent().addClass("sliderHolder");a.slider({value:$(this).val()||0,min:$(this).data("min"),max:$(this).data("max"),step:$(this).data("step"),slide:function(a,b){c.val(b.value);c.parent().find("input.sliderInfo").val(b.value)}});
$(this).on("change keyup",function(){var c=parseInt($(this).val());a.slider("value",c);a.slider("option","max")<c&&a.slider("option","max",c);a.slider("option","min")>c&&a.slider("option","min",c)})})},createButtons:function(){$(".buttonset").buttonset()},beautifyInputs:function(a,b){this.createUploader(a,b);this.improveOtito(this.content.activeItem)},improveOtito:function(a){var b=this;Otito.beautifyInputs(a,function(a,d){if("text"!=d.meta._type&&b.content.ui["otito_"+d.meta._type])b.content.ui["otito_"+
d.meta._type](d)})},otito_list:function(a){$(a.input).combobox();$(".input",a.html).addClass("special list")},otito_bool:function(a){$(a.input).boolean()},otito_boolean:function(a){$(a.input).boolean()},otito_color:function(a){var b=$('<span class="colorpicker"></span>');$(a.input).colorpicker({showOn:"click",inlineFrame:!1,select:function(c,d){b.css({"background-color":"#"+d.formatted});a.input.setValue("#"+d.formatted)}});$(a.input).hide();b.css({"background-color":a.object});b.appendTo($(a.html).find(".input"));
b.click(function(b){b.stopPropagation();$(a.input).colorpicker("open")})},otito_int:function(a){this.otito_number(a)},otito_number:function(a){var b=a.input,c=b.getAttribute("min"),d=b.getAttribute("max");if(c&&d){var e=document.createElement("div");a.input.parentNode.appendChild(e);a.input.parentNode.className="input special slider";a.input.style.display="none";b=$(e).slider({orientation:"horizontal",range:"min",max:d,min:c,value:b.value,change:function(b,c){a.input.setValue(c.value)},slide:function(a,
b){$(b.handle).attr("value",b.value)}});$(".ui-slider-handle",b).attr("value",a.input.value)}else $(a.input).adjust()},otito_float:function(a){this.otito_number(a)},otito_double:function(a){this.otito_number(a)},createSimpleUpload:function(a,b){var c=this;new qq.FileUploader({element:a,allowedExtensions:this.content.cfg.projectExtension.split(","),action:cfg.uploadFile,params:{action:"importProject"},buttonText:"",onComplete:function(a,e,f){f&&($(c),$(c).find(".qq-upload-list").children().remove(),
c.content.setActiveProject(f.file),b&&b())}})},createUploader:function(a,b){var b=b||this.$settings,c=this,d="jpg, png, jpeg, bmp, ogg, mp3, wav";$("div.upload",b).each(function(){if($(this).hasClass("upload-ready"))return!0;$(this).addClass("upload-ready");var a,b,g,i;$(this).addClass("icon");a=this;g=document.createElement("div");i=$(this).find("input")[0];var j=i.value.split("/").pop();(b=i.extensions)&&(d=b);d=d.replace(/ /g,"");$(i).hide();b=Templates.getTagByFile(c.content.activeProjectPath+
"/"+cfg.uploadPath+j);g.innerHTML=b;g.setAttribute("class","image");this.appendChild(g);b=document.createElement("div");g.appendChild(b);new qq.FileUploader({element:b,allowedExtensions:d.split(","),action:cfg.uploadFile,params:{project:c.content.activeProject,action:"itemFile"},onComplete:function(b,d,f){f&&(b=$(a),$(a).find(".qq-upload-list").children().remove(),f=f.file.split("/").pop(),d=$(Templates.getTagByFile(c.content.activeProjectPath+"/"+cfg.uploadPath+f)),b.find(".image > *:first").replaceWith(d),
b.find(".itemImage:first").val(f),i.setValue(f),c.initControls(b))}})})},createList:function(){this.$settings.find("select").combobox()},initControls:function(a){var b=this,a=void 0===a?this.$iconContainer:$(a),c=a.find(".controls");if(0!=c.length){var d=a.find(c.data("element"))[0];c.children("div").each(function(){var a=$(this),c=a.data("action");if(c)switch(c){case "playstop":a.click(function(){"1"===a.data("playing")?(d.pause(),a.data("playing","0")):(d.play(),a.data("playing","1"))});d.addEventListener("ended",
function(){a.data("playing","0")});break;case "project":a.click(function(a){a.preventDefault();a.bubbles=!1;window.open(b.content.activeProjectPath+"/assets/deploy/"+b.content.projectInfo.branchId+"/library.js","_newtab");return!1})}})}},createDeleteBlock:function(a){var b=$(Templates.deleteButton()),c=$(Templates.clear());b.on("click",function(a){a.preventDefault();$(this).parent().remove();return!1});$("div.toDelete",a).removeClass("toDelete").addClass("toDeleteInit").append(b).append(c)},createDynamicTemplate:function(a){var b=
this;$(".addMore",a).off("click").on("click",function(c){c.preventDefault();c=$('<div class="toDelete">'+Templates.saved[$(this).data("id")]+"</div>");$(this).before(c);b.createWidgets(c);b.createDeleteBlock(a);return!1});b.createDeleteBlock(a)},refreshScrollbars:function(){for(var a=0;a<this.scrollBars.length;a++)this.scrollBars[a].scroller.refresh(),this.scrollBars[a].left&&this.scrollBars[a].scroller.vScrollbarWrapper&&(this.scrollBars[a].scroller.vScrollbarWrapper.className="leftScroll")},attachScroller:function(a,
b){a.scroller=1;for(var c={parent:a.parentNode,scroller:null,node:a,left:b},d=[],e=null;e=a.firstChild;)d.push(a.removeChild(e));e=document.createElement("div");e.style.height="100%";e.style.position="relative";a.appendChild(e);var f=document.createElement("div");e.appendChild(f);var g=document.createElement("div");g.style.height="100%";g.style.width="100%";f.appendChild(g);for(f=0;f<d.length;f++)g.appendChild(d[f]);c.scroller=new iScroll(e,{hScrollbar:!1,vScrollbar:!0,vScroll:!0,fadeScrollbar:!0,
checkDOMChanges:!0});c.scroller.vScrollbarWrapper&&b&&(c.scroller.vScrollbarWrapper.className="leftScroll");e.style.overflow="visible";this.scrollBars.push(c);return c}});this.Tools.ui={cache:{},addCss:function(a){if(!this.cache[a]){this.cache[a]=!0;var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("href",a);document.head.appendChild(b);return b}}};
